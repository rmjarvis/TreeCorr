

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>treecorr.gggcorrelation &mdash; TreeCorr 4.1.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> TreeCorr
          

          
          </a>

          
            
            
              <div class="version">
                4.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../catalog.html">Input Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../correlation2.html">Two-point Correlation Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../correlation3.html">Three-point Correlation Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../metric.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../binning.html">Binning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../patches.html">Patches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cov.html">Covariance Estimates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../field.html">Fields</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scripts.html">Using configuration files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../params.html">Configuration Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changes.html">Changes from version 4.0 to 4.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../history.html">Previous History</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">TreeCorr</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>treecorr.gggcorrelation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for treecorr.gggcorrelation</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (c) 2003-2019 by Mike Jarvis</span>
<span class="c1">#</span>
<span class="c1"># TreeCorr is free software: redistribution and use in source and binary forms,</span>
<span class="c1"># with or without modification, are permitted provided that the following</span>
<span class="c1"># conditions are met:</span>
<span class="c1">#</span>
<span class="c1"># 1. Redistributions of source code must retain the above copyright notice, this</span>
<span class="c1">#    list of conditions, and the disclaimer given in the accompanying LICENSE</span>
<span class="c1">#    file.</span>
<span class="c1"># 2. Redistributions in binary form must reproduce the above copyright notice,</span>
<span class="c1">#    this list of conditions, and the disclaimer given in the documentation</span>
<span class="c1">#    and/or other materials provided with the distribution.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. module:: nnncorrelation</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">treecorr</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<div class="viewcode-block" id="GGGCorrelation"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation">[docs]</a><span class="k">class</span> <span class="nc">GGGCorrelation</span><span class="p">(</span><span class="n">treecorr</span><span class="o">.</span><span class="n">BinnedCorr3</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;This class handles the calculation and storage of a 3-point shear-shear-shear correlation</span>
<span class="sd">    function.</span>

<span class="sd">    We use the &quot;natural components&quot; of the shear 3-point function described by Schneider &amp;</span>
<span class="sd">    Lombardi (2003) [Astron.Astrophys. 397 (2003) 809-818].  In this paradigm, the shears</span>
<span class="sd">    are projected relative to some point defined by the geometry of the triangle.  They</span>
<span class="sd">    give several reasonable choices for this point.  We choose the triangle&#39;s centroid as the</span>
<span class="sd">    &quot;most natural&quot; point, as many simple shear fields have purely real :math:`\Gamma_0` using</span>
<span class="sd">    this definition.  It is also a fairly simple point to calculate in the code compared to</span>
<span class="sd">    some of the other options they offer, so projections relative to it are fairly efficient.</span>

<span class="sd">    There are 4 complex-valued 3-point shear corrletion functions defined for triples of shear</span>
<span class="sd">    values projected relative to the line joining the location of the shear to the cenroid of</span>
<span class="sd">    the triangle:</span>

<span class="sd">    .. math::</span>

<span class="sd">        \Gamma_0 &amp;= \langle \gamma(\mathbf{x1}) \gamma(\mathbf{x2}) \gamma(\mathbf{x3}) \rangle \\</span>
<span class="sd">        \Gamma_1 &amp;= \langle \gamma(\mathbf{x1})^* \gamma(\mathbf{x2}) \gamma(\mathbf{x3}) \rangle \\</span>
<span class="sd">        \Gamma_2 &amp;= \langle \gamma(\mathbf{x1}) \gamma(\mathbf{x2})^* \gamma(\mathbf{x3}) \rangle \\</span>
<span class="sd">        \Gamma_3 &amp;= \langle \gamma(\mathbf{x1}) \gamma(\mathbf{x2}) \gamma(\mathbf{x3})^* \rangle \\</span>

<span class="sd">    where :math:`\mathbf{x1}, \mathbf{x2}, \mathbf{x3}` are the corners of the triange opposite</span>
<span class="sd">    sides d1, d2, d3 respectively, where d1 &gt; d2 &gt; d3, and :math:`{}^*` indicates complex</span>
<span class="sd">    conjugation.</span>

<span class="sd">    See the doc string of `BinnedCorr3` for a description of how the triangles</span>
<span class="sd">    are binned.</span>

<span class="sd">    Ojects of this class holds the following attributes:</span>

<span class="sd">    Attributes:</span>
<span class="sd">        nbins:      The number of bins in logr where r = d2</span>
<span class="sd">        bin_size:   The size of the bins in logr</span>
<span class="sd">        min_sep:    The minimum separation being considered</span>
<span class="sd">        max_sep:    The maximum separation being considered</span>
<span class="sd">        nubins:     The number of bins in u where u = d3/d2</span>
<span class="sd">        ubin_size:  The size of the bins in u</span>
<span class="sd">        min_u:      The minimum u being considered</span>
<span class="sd">        max_u:      The maximum u being considered</span>
<span class="sd">        nvbins:     The number of bins in v where v = +-(d1-d2)/d3</span>
<span class="sd">        vbin_size:  The size of the bins in v</span>
<span class="sd">        min_v:      The minimum v being considered</span>
<span class="sd">        max_v:      The maximum v being considered</span>
<span class="sd">        logr1d:     The nominal centers of the nbins bins in log(r).</span>
<span class="sd">        u1d:        The nominal centers of the nubins bins in u.</span>
<span class="sd">        v1d:        The nominal centers of the nvbins bins in v.</span>

<span class="sd">    In addition, the following attributes are numpy arrays whose shape is (nbins, nubins, nvbins):</span>

<span class="sd">    Attributes:</span>
<span class="sd">        logr:       The nominal center of each bin in log(r).</span>
<span class="sd">        rnom:       The nominal center of the bin converted to regular distance.</span>
<span class="sd">                    i.e. r = exp(logr).</span>
<span class="sd">        u:          The nominal center of each bin in u.</span>
<span class="sd">        v:          The nominal center of each bin in v.</span>
<span class="sd">        meand1:     The (weighted) mean value of d1 for the triangles in each bin.</span>
<span class="sd">        meanlogd1:  The mean value of log(d1) for the triangles in each bin.</span>
<span class="sd">        meand2:     The (weighted) mean value of d2 (aka r) for the triangles in each bin.</span>
<span class="sd">        meanlogd2:  The mean value of log(d2) for the triangles in each bin.</span>
<span class="sd">        meand2:     The (weighted) mean value of d3 for the triangles in each bin.</span>
<span class="sd">        meanlogd2:  The mean value of log(d3) for the triangles in each bin.</span>
<span class="sd">        meanu:      The mean value of u for the triangles in each bin.</span>
<span class="sd">        meanv:      The mean value of v for the triangles in each bin.</span>
<span class="sd">        gam0:       The 0th &quot;natural&quot; correlation function, :math:`\Gamma_0(r,u,v)`.</span>
<span class="sd">        gam1:       The 1st &quot;natural&quot; correlation function, :math:`\Gamma_1(r,u,v)`.</span>
<span class="sd">        gam2:       The 2nd &quot;natural&quot; correlation function, :math:`\Gamma_2(r,u,v)`.</span>
<span class="sd">        gam3:       The 3rd &quot;natural&quot; correlation function, :math:`\Gamma_3(r,u,v)`.</span>
<span class="sd">        vargam0:    The variance of :math:`\Gamma_0`, only including the shot noise</span>
<span class="sd">                    propagated into the final correlation.  This (and the related values for</span>
<span class="sd">                    1,2,3) does not include sample variance, so it is always an underestimate</span>
<span class="sd">                    of the actual variance.</span>
<span class="sd">        vargam1:    The variance of :math:`\Gamma_1`.</span>
<span class="sd">        vargam2:    The variance of :math:`\Gamma_2`.</span>
<span class="sd">        vargam3:    The variance of :math:`\Gamma_3`.</span>
<span class="sd">        weight:     The total weight in each bin.</span>
<span class="sd">        ntri:       The number of triangles going into each bin (including those where one or</span>
<span class="sd">                    more objects have w=0).</span>

<span class="sd">    If ``sep_units`` are given (either in the config dict or as a named kwarg) then the distances</span>
<span class="sd">    will all be in these units.</span>

<span class="sd">    .. note::</span>

<span class="sd">        If you separate out the steps of the `process` command and use `process_auto` and/or</span>
<span class="sd">        `process_cross`, then the units will not be applied to ``meanr`` or ``meanlogr`` until</span>
<span class="sd">        the `finalize` function is called.</span>

<span class="sd">    The typical usage pattern is as follows::</span>

<span class="sd">        &gt;&gt;&gt; ggg = treecorr.GGGCorrelation(config)</span>
<span class="sd">        &gt;&gt;&gt; ggg.process(cat)              # For auto-correlation.</span>
<span class="sd">        &gt;&gt;&gt; ggg.process(cat1,cat2,cat3)   # For cross-correlation.</span>
<span class="sd">        &gt;&gt;&gt; ggg.write(file_name)          # Write out to a file.</span>
<span class="sd">        &gt;&gt;&gt; gam0 = ggg.gam0, etc.         # To access gamma values directly.</span>
<span class="sd">        &gt;&gt;&gt; gam0r = ggg.gam0r             # You can also access real and imag parts separately.</span>
<span class="sd">        &gt;&gt;&gt; gam0i = ggg.gam0i</span>

<span class="sd">    Parameters:</span>
<span class="sd">        config (dict):  A configuration dict that can be used to pass in kwargs if desired.</span>
<span class="sd">                        This dict is allowed to have addition entries besides those listed</span>
<span class="sd">                        in `BinnedCorr3`, which are ignored here. (default: None)</span>
<span class="sd">        logger:         If desired, a logger object for logging. (default: None, in which case</span>
<span class="sd">                        one will be built according to the config dict&#39;s verbose level.)</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">        **kwargs:       See the documentation for `BinnedCorr3` for the list of allowed keyword</span>
<span class="sd">                        arguments, which may be passed either directly or in the config dict.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="GGGCorrelation.__init__"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize `GGGCorrelation`.  See class doc for details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">treecorr</span><span class="o">.</span><span class="n">BinnedCorr3</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_d1</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># GData</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_d2</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># GData</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_d3</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># GData</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logr</span><span class="o">.</span><span class="n">shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam0r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam1r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam2r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam3r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam0i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam1i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam2i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam3i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ntri</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Finished building GGGCorr&#39;</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gam0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam0r</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam0i</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gam1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam1r</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam1i</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gam2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam2r</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam2i</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gam3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam3r</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam3i</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">corr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_corr&#39;</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">treecorr.util</span> <span class="kn">import</span> <span class="n">double_ptr</span> <span class="k">as</span> <span class="n">dp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_corr</span> <span class="o">=</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">_lib</span><span class="o">.</span><span class="n">BuildCorr3</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_d1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bintype</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_min_sep</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_sep</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nbins</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_bin_size</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">min_u</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">max_u</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nubins</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ubin_size</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">bu</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">min_v</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">max_v</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nvbins</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">vbin_size</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">bv</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">min_rpar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_rpar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xperiod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yperiod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zperiod</span><span class="p">,</span>
                    <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam0r</span><span class="p">),</span> <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam0i</span><span class="p">),</span> <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam1r</span><span class="p">),</span> <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam1i</span><span class="p">),</span>
                    <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam2r</span><span class="p">),</span> <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam2i</span><span class="p">),</span> <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam3r</span><span class="p">),</span> <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam3i</span><span class="p">),</span>
                    <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meand1</span><span class="p">),</span> <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meanlogd1</span><span class="p">),</span> <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meand2</span><span class="p">),</span> <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meanlogd2</span><span class="p">),</span>
                    <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meand3</span><span class="p">),</span> <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meanlogd3</span><span class="p">),</span> <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meanu</span><span class="p">),</span> <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meanv</span><span class="p">),</span>
                    <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">),</span> <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ntri</span><span class="p">));</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_corr</span>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Using memory allocated from the C layer means we have to explicitly deallocate it</span>
        <span class="c1"># rather than being able to rely on the Python memory manager.</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_corr&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">_ffi</span><span class="o">.</span><span class="n">_lock</span><span class="o">.</span><span class="n">locked</span><span class="p">():</span> <span class="c1"># pragma: no branch</span>
                <span class="n">treecorr</span><span class="o">.</span><span class="n">_lib</span><span class="o">.</span><span class="n">DestroyCorr3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bintype</span><span class="p">)</span>

<div class="viewcode-block" id="GGGCorrelation.__eq__"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.__eq__">[docs]</a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether two `GGGCorrelation` instances are equal&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GGGCorrelation</span><span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nbins</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">nbins</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bin_size</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">bin_size</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">min_sep</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">min_sep</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_sep</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">max_sep</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sep_units</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">sep_units</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">min_u</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">min_u</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_u</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">max_u</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nubins</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">nubins</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ubin_size</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">ubin_size</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">min_v</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">min_v</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_v</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">max_v</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nvbins</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">nvbins</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vbin_size</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">vbin_size</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coords</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">coords</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bin_type</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">bin_type</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bin_slop</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">bin_slop</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">min_rpar</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">min_rpar</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_rpar</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">max_rpar</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xperiod</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">xperiod</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">yperiod</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">yperiod</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">zperiod</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">zperiod</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meand1</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">meand1</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meanlogd1</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">meanlogd1</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meand2</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">meand2</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meanlogd2</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">meanlogd2</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meand3</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">meand3</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meanlogd3</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">meanlogd3</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meanu</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">meanu</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meanv</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">meanv</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam0r</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">gam0r</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam0i</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">gam0i</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam1r</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">gam1r</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam1i</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">gam1i</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam2r</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">gam2r</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam2i</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">gam2i</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam3r</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">gam3r</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam3i</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">gam3i</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vargam0</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">vargam0</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vargam1</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">vargam1</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vargam2</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">vargam2</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vargam3</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">vargam3</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ntri</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">ntri</span><span class="p">))</span></div>


<div class="viewcode-block" id="GGGCorrelation.copy"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make a copy&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">copy</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_corr&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;logger&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># Oh well.  This is just lost in the copy.  Can&#39;t be pickled.</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="o">=</span> <span class="n">d</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setup_logger</span><span class="p">(</span>
                <span class="n">treecorr</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span><span class="s1">&#39;verbose&#39;</span><span class="p">,</span><span class="nb">int</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;log_file&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span>

<div class="viewcode-block" id="GGGCorrelation.__repr__"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.__repr__">[docs]</a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;GGGCorrelation(config=</span><span class="si">%r</span><span class="s1">)&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span></div>

<div class="viewcode-block" id="GGGCorrelation.process_auto"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.process_auto">[docs]</a>    <span class="k">def</span> <span class="nf">process_auto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cat</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_threads</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process a single catalog, accumulating the auto-correlation.</span>

<span class="sd">        This accumulates the auto-correlation for the given catalog.  After</span>
<span class="sd">        calling this function as often as desired, the `finalize` command will</span>
<span class="sd">        finish the calculation of meand1, meanlogd1, etc.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            cat (Catalog):      The catalog to process</span>
<span class="sd">            metric (str):       Which metric to use.  See `Metrics` for details.</span>
<span class="sd">                                (default: &#39;Euclidean&#39;; this value can also be given in the</span>
<span class="sd">                                constructor in the config dict.)</span>
<span class="sd">            num_threads (int):  How many OpenMP threads to use during the calculation.</span>
<span class="sd">                                (default: use the number of cpu cores; this value can also be given</span>
<span class="sd">                                in the constructor in the config dict.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cat</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting process GGG auto-correlations&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting process GGG auto-correlations for cat </span><span class="si">%s</span><span class="s1">.&#39;</span><span class="p">,</span> <span class="n">cat</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_metric</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">cat</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_num_threads</span><span class="p">(</span><span class="n">num_threads</span><span class="p">)</span>

        <span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_minmax_size</span><span class="p">()</span>

        <span class="n">field</span> <span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">getGField</span><span class="p">(</span><span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_method</span><span class="p">,</span>
                              <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brute</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting </span><span class="si">%d</span><span class="s1"> jobs.&#39;</span><span class="p">,</span><span class="n">field</span><span class="o">.</span><span class="n">nTopLevelNodes</span><span class="p">)</span>
        <span class="n">treecorr</span><span class="o">.</span><span class="n">_lib</span><span class="o">.</span><span class="n">ProcessAuto3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_dots</span><span class="p">,</span>
                                   <span class="n">field</span><span class="o">.</span><span class="n">_d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bintype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metric</span><span class="p">)</span></div>

<div class="viewcode-block" id="GGGCorrelation.process_cross21"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.process_cross21">[docs]</a>    <span class="k">def</span> <span class="nf">process_cross21</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cat1</span><span class="p">,</span> <span class="n">cat2</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_threads</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process two catalogs, accumulating the 3pt cross-correlation, where two of the</span>
<span class="sd">        points in each triangle come from the first catalog, and one from the second.</span>

<span class="sd">        This accumulates the cross-correlation for the given catalogs.  After</span>
<span class="sd">        calling this function as often as desired, the `finalize` command will</span>
<span class="sd">        finish the calculation of meand1, meanlogd1, etc.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            This is not implemented yet.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            cat1 (Catalog):     The first catalog to process</span>
<span class="sd">            cat2 (Catalog):     The second catalog to process</span>
<span class="sd">            metric (str):       Which metric to use.  See `Metrics` for details.</span>
<span class="sd">                                (default: &#39;Euclidean&#39;; this value can also be given in the</span>
<span class="sd">                                constructor in the config dict.)</span>
<span class="sd">            num_threads (int):  How many OpenMP threads to use during the calculation.</span>
<span class="sd">                                (default: use the number of cpu cores; this value can also be given</span>
<span class="sd">                                in the constructor in the config dict.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;No partial cross GGG yet.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="GGGCorrelation.process_cross"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.process_cross">[docs]</a>    <span class="k">def</span> <span class="nf">process_cross</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cat1</span><span class="p">,</span> <span class="n">cat2</span><span class="p">,</span> <span class="n">cat3</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_threads</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process a set of three catalogs, accumulating the 3pt cross-correlation.</span>

<span class="sd">        This accumulates the cross-correlation for the given catalogs.  After</span>
<span class="sd">        calling this function as often as desired, the `finalize` command will</span>
<span class="sd">        finish the calculation of meand1, meanlogd1, etc.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            cat1 (Catalog):     The first catalog to process</span>
<span class="sd">            cat2 (Catalog):     The second catalog to process</span>
<span class="sd">            cat3 (Catalog):     The third catalog to process</span>
<span class="sd">            metric (str):       Which metric to use.  See `Metrics` for details.</span>
<span class="sd">                                (default: &#39;Euclidean&#39;; this value can also be given in the</span>
<span class="sd">                                constructor in the config dict.)</span>
<span class="sd">            num_threads (int):  How many OpenMP threads to use during the calculation.</span>
<span class="sd">                                (default: use the number of cpu cores; this value can also be given</span>
<span class="sd">                                in the constructor in the config dict.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cat1</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">cat2</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">cat3</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting process GGG cross-correlations&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting process GGG cross-correlations for cats </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">.&#39;</span><span class="p">,</span>
                             <span class="n">cat1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">cat2</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">cat3</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_metric</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">cat1</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">cat2</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">cat3</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_num_threads</span><span class="p">(</span><span class="n">num_threads</span><span class="p">)</span>

        <span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_minmax_size</span><span class="p">()</span>

        <span class="n">f1</span> <span class="o">=</span> <span class="n">cat1</span><span class="o">.</span><span class="n">getGField</span><span class="p">(</span><span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_method</span><span class="p">,</span>
                            <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brute</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="n">f2</span> <span class="o">=</span> <span class="n">cat2</span><span class="o">.</span><span class="n">getGField</span><span class="p">(</span><span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_method</span><span class="p">,</span>
                            <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brute</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="n">f3</span> <span class="o">=</span> <span class="n">cat3</span><span class="o">.</span><span class="n">getGField</span><span class="p">(</span><span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_method</span><span class="p">,</span>
                            <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brute</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting </span><span class="si">%d</span><span class="s1"> jobs.&#39;</span><span class="p">,</span><span class="n">f1</span><span class="o">.</span><span class="n">nTopLevelNodes</span><span class="p">)</span>
        <span class="n">treecorr</span><span class="o">.</span><span class="n">_lib</span><span class="o">.</span><span class="n">ProcessCross3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span> <span class="n">f1</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">f2</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">f3</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_dots</span><span class="p">,</span>
                                    <span class="n">f1</span><span class="o">.</span><span class="n">_d</span><span class="p">,</span> <span class="n">f2</span><span class="o">.</span><span class="n">_d</span><span class="p">,</span> <span class="n">f3</span><span class="o">.</span><span class="n">_d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bintype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metric</span><span class="p">)</span></div>


<div class="viewcode-block" id="GGGCorrelation.finalize"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.finalize">[docs]</a>    <span class="k">def</span> <span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">varg1</span><span class="p">,</span> <span class="n">varg2</span><span class="p">,</span> <span class="n">varg3</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Finalize the calculation of the correlation function.</span>

<span class="sd">        The `process_auto` and `process_cross` commands accumulate values in each bin,</span>
<span class="sd">        so they can be called multiple times if appropriate.  Afterwards, this command</span>
<span class="sd">        finishes the calculation by dividing by the total weight.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            varg1 (float):  The shear variance for the first field.</span>
<span class="sd">            varg2 (float):  The shear variance for the second field.</span>
<span class="sd">            varg3 (float):  The shear variance for the third field.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mask1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="n">mask2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">==</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gam0r</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam0i</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam1r</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam1i</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam2r</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam2i</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam3r</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam3i</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand1</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd1</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand2</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd2</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand3</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd3</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanu</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanv</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>

        <span class="c1"># Update the units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_units</span><span class="p">(</span><span class="n">mask1</span><span class="p">)</span>

        <span class="c1"># Use meanlogr when available, but set to nominal when no triangles in bin.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand2</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnom</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd2</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logr</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanu</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanv</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand3</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">meand2</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd3</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meand3</span><span class="p">[</span><span class="n">mask2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand1</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">meand3</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">meand2</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd1</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meand1</span><span class="p">[</span><span class="n">mask2</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vargam0</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">=</span> <span class="n">varg1</span> <span class="o">*</span> <span class="n">varg2</span> <span class="o">*</span> <span class="n">varg3</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam1</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">=</span> <span class="n">varg1</span> <span class="o">*</span> <span class="n">varg2</span> <span class="o">*</span> <span class="n">varg3</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam2</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">=</span> <span class="n">varg1</span> <span class="o">*</span> <span class="n">varg2</span> <span class="o">*</span> <span class="n">varg3</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam3</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">=</span> <span class="n">varg1</span> <span class="o">*</span> <span class="n">varg2</span> <span class="o">*</span> <span class="n">varg3</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam0</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam1</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam2</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam3</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span></div>

<div class="viewcode-block" id="GGGCorrelation.clear"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear the data vectors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam0r</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam0i</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam1r</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam1i</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam2r</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam2i</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam3r</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam3i</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam0</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam1</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam2</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam3</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand1</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd1</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand2</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd2</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand3</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd3</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanu</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanv</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ntri</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>

<div class="viewcode-block" id="GGGCorrelation.__iadd__"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.__iadd__">[docs]</a>    <span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a second `GGGCorrelation`&#39;s data to this one.</span>

<span class="sd">        .. note::</span>

<span class="sd">            For this to make sense, both `GGGCorrelation` objects should have been using</span>
<span class="sd">            `process_auto` and/or `process_cross`, and they should not have had `finalize` called</span>
<span class="sd">            yet.  Then, after adding them together, you should call `finalize` on the sum.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GGGCorrelation</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Can only add another GGGCorrelation object&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nbins</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">nbins</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">min_sep</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">min_sep</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_sep</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">max_sep</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nubins</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">nubins</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">min_u</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">min_u</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_u</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">max_u</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nvbins</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">nvbins</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">min_v</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">min_v</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_v</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">max_v</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;GGGCorrelation to be added is not compatible with this one.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_metric</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">metric</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam0r</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">gam0r</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam0i</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">gam0i</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam1r</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">gam1r</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam1i</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">gam1i</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam2r</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">gam2r</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam2i</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">gam2i</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam3r</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">gam3r</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam3i</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">gam3i</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam0</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">vargam0</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam1</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">vargam1</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam2</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">vargam2</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam3</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">vargam3</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand1</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">meand1</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd1</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">meanlogd1</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand2</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">meand2</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd2</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">meanlogd2</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand3</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">meand3</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd3</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">meanlogd3</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanu</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">meanu</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanv</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">meanv</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">weight</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ntri</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">ntri</span><span class="p">[:]</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="GGGCorrelation.process"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.process">[docs]</a>    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cat1</span><span class="p">,</span> <span class="n">cat2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cat3</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_threads</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Accumulate the number of triangles of points between cat1, cat2, and cat3.</span>

<span class="sd">        - If only 1 argument is given, then compute an auto-correlation function.</span>
<span class="sd">        - If 2 arguments are given, then compute a cross-correlation function with the</span>
<span class="sd">          first catalog taking two corners of the triangles. (Not implemented yet.)</span>
<span class="sd">        - If 3 arguments are given, then compute a cross-correlation function.</span>

<span class="sd">        All arguments may be lists, in which case all items in the list are used</span>
<span class="sd">        for that element of the correlation.</span>

<span class="sd">        .. note::</span>

<span class="sd">            For a correlation of multiple catalogs, it matters which corner of the</span>
<span class="sd">            triangle comes from which catalog.  The final accumulation will have</span>
<span class="sd">            d1 &gt; d2 &gt; d3 where d1 is between two points in cat2,cat3; d2 is between</span>
<span class="sd">            points in cat1,cat3; and d3 is between points in cat1,cat2.  To accumulate</span>
<span class="sd">            all the possible triangles between three catalogs, you should call this</span>
<span class="sd">            multiple times with the different catalogs in different positions.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            cat1 (Catalog):     A catalog or list of catalogs for the first N field.</span>
<span class="sd">            cat2 (Catalog):     A catalog or list of catalogs for the second N field, if any.</span>
<span class="sd">                                (default: None)</span>
<span class="sd">            cat3 (Catalog):     A catalog or list of catalogs for the third N field, if any.</span>
<span class="sd">                                (default: None)</span>
<span class="sd">            metric (str):       Which metric to use.  See `Metrics` for details.</span>
<span class="sd">                                (default: &#39;Euclidean&#39;; this value can also be given in the</span>
<span class="sd">                                constructor in the config dict.)</span>
<span class="sd">            num_threads (int):  How many OpenMP threads to use during the calculation.</span>
<span class="sd">                                (default: use the number of cpu cores; this value can also be given</span>
<span class="sd">                                in the constructor in the config dict.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">math</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cat1</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span> <span class="n">cat1</span> <span class="o">=</span> <span class="n">cat1</span><span class="o">.</span><span class="n">get_patches</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cat2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cat2</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span> <span class="n">cat2</span> <span class="o">=</span> <span class="n">cat2</span><span class="o">.</span><span class="n">get_patches</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cat3</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cat3</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span> <span class="n">cat3</span> <span class="o">=</span> <span class="n">cat3</span><span class="o">.</span><span class="n">get_patches</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">cat2</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cat3</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">varg1</span> <span class="o">=</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">calculateVarG</span><span class="p">(</span><span class="n">cat1</span><span class="p">)</span>
            <span class="n">varg2</span> <span class="o">=</span> <span class="n">varg1</span>
            <span class="n">varg3</span> <span class="o">=</span> <span class="n">varg1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;varg = </span><span class="si">%f</span><span class="s2">: sig_g = </span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">varg1</span><span class="p">,</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">varg1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_process_all_auto</span><span class="p">(</span><span class="n">cat1</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">num_threads</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">cat2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">!=</span> <span class="p">(</span><span class="n">cat3</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;No partial cross GGG yet.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">cat2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cat3</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="n">varg1</span> <span class="o">=</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">calculateVarG</span><span class="p">(</span><span class="n">cat1</span><span class="p">)</span>
            <span class="n">varg2</span> <span class="o">=</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">calculateVarG</span><span class="p">(</span><span class="n">cat2</span><span class="p">)</span>
            <span class="n">varg3</span> <span class="o">=</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">calculateVarG</span><span class="p">(</span><span class="n">cat3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;varg1 = </span><span class="si">%f</span><span class="s2">: sig_g = </span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">varg1</span><span class="p">,</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">varg1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;varg2 = </span><span class="si">%f</span><span class="s2">: sig_g = </span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">varg2</span><span class="p">,</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">varg2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;varg3 = </span><span class="si">%f</span><span class="s2">: sig_g = </span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">varg3</span><span class="p">,</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">varg3</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_process_all_cross</span><span class="p">(</span><span class="n">cat1</span><span class="p">,</span> <span class="n">cat2</span><span class="p">,</span> <span class="n">cat3</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">num_threads</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">varg1</span><span class="p">,</span><span class="n">varg2</span><span class="p">,</span><span class="n">varg3</span><span class="p">)</span></div>


<div class="viewcode-block" id="GGGCorrelation.write"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Write the correlation function to the file, file_name.</span>

<span class="sd">        As described in the doc string for `GGGCorrelation`, we use the &quot;natural components&quot; of</span>
<span class="sd">        the shear 3-point function described by Schneider &amp; Lombardi (2003) using the triangle</span>
<span class="sd">        centroid as the projection point.  There are 4 complex-valued natural components, so there</span>
<span class="sd">        are 8 columns in the output file.</span>

<span class="sd">        The output file will include the following columns:</span>

<span class="sd">        ==========      =============================================================</span>
<span class="sd">        Column          Description</span>
<span class="sd">        ==========      =============================================================</span>
<span class="sd">        r_nom           The nominal center of the bin in r = d2 where d1 &gt; d2 &gt; d3</span>
<span class="sd">        u_nom           The nominal center of the bin in u = d3/d2</span>
<span class="sd">        v_nom           The nominal center of the bin in v = +-(d1-d2)/d3</span>
<span class="sd">        meand1          The mean value :math:`\langle d1\rangle` of triangles that</span>
<span class="sd">                        fell into each bin</span>
<span class="sd">        meanlogd1       The mean value :math:`\langle \log(d1)\rangle` of triangles</span>
<span class="sd">                        that fell into each bin</span>
<span class="sd">        meand2          The mean value :math:`\langle d2\rangle` of triangles that</span>
<span class="sd">                        fell into each bin</span>
<span class="sd">        meanlogd2       The mean value :math:`\langle \log(d2)\rangle` of triangles</span>
<span class="sd">                        that fell into each bin</span>
<span class="sd">        meand3          The mean value :math:`\langle d3\rangle` of triangles that</span>
<span class="sd">                        fell into each bin</span>
<span class="sd">        meanlogd3       The mean value :math:`\langle \log(d3)\rangle` of triangles</span>
<span class="sd">                        that fell into each bin</span>
<span class="sd">        meanu           The mean value :math:`\langle u\rangle` of triangles that</span>
<span class="sd">                        fell into each bin</span>
<span class="sd">        meanv           The mean value :math:`\langle v\rangle` of triangles that</span>
<span class="sd">                        fell into each bi.</span>
<span class="sd">        gam0r           The real part of the estimator of :math:`\Gamma_0(r,u,v)`</span>
<span class="sd">        gam0i           The imag part of the estimator of :math:`\Gamma_0(r,u,v)`</span>
<span class="sd">        gam1r           The real part of the estimator of :math:`\Gamma_1(r,u,v)`</span>
<span class="sd">        gam1i           The imag part of the estimator of :math:`\Gamma_1(r,u,v)`</span>
<span class="sd">        gam2r           The real part of the estimator of :math:`\Gamma_2(r,u,v)`</span>
<span class="sd">        gam2i           The imag part of the estimator of :math:`\Gamma_2(r,u,v)`</span>
<span class="sd">        gam3r           The real part of the estimator of :math:`\Gamma_3(r,u,v)`</span>
<span class="sd">        gam3i           The imag part of the estimator of :math:`\Gamma_3(r,u,v)`</span>
<span class="sd">        sigma_gam0      The sqrt of the variance estimate of :math:`\Gamma_0`</span>
<span class="sd">        sigma_gam1      The sqrt of the variance estimate of :math:`\Gamma_1`</span>
<span class="sd">        sigma_gam2      The sqrt of the variance estimate of :math:`\Gamma_2`</span>
<span class="sd">        sigma_gam3      The sqrt of the variance estimate of :math:`\Gamma_3`</span>
<span class="sd">        weight          The total weight of triangles contributing to each bin.</span>
<span class="sd">        ntri            The number of triangles contributing to each bin.</span>
<span class="sd">        ==========      =============================================================</span>

<span class="sd">        If ``sep_units`` was given at construction, then the distances will all be in these units.</span>
<span class="sd">        Otherwise, they will be in either the same units as x,y,z (for flat or 3d coordinates) or</span>
<span class="sd">        radians (for spherical coordinates).</span>

<span class="sd">        Parameters:</span>
<span class="sd">            file_name (str):    The name of the file to write to.</span>
<span class="sd">            file_type (str):    The type of file to write (&#39;ASCII&#39; or &#39;FITS&#39;).  (default: determine</span>
<span class="sd">                                the type automatically from the extension of file_name.)</span>
<span class="sd">            precision (int):    For ASCII output catalogs, the desired precision. (default: 4;</span>
<span class="sd">                                this value can also be given in the constructor in the config dict.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Writing GGG correlations to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">file_name</span><span class="p">)</span>

        <span class="n">col_names</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;r_nom&#39;</span><span class="p">,</span> <span class="s1">&#39;u_nom&#39;</span><span class="p">,</span> <span class="s1">&#39;v_nom&#39;</span><span class="p">,</span> <span class="s1">&#39;meand1&#39;</span><span class="p">,</span> <span class="s1">&#39;meanlogd1&#39;</span><span class="p">,</span> <span class="s1">&#39;meand2&#39;</span><span class="p">,</span> <span class="s1">&#39;meanlogd2&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;meand3&#39;</span><span class="p">,</span> <span class="s1">&#39;meanlogd3&#39;</span><span class="p">,</span> <span class="s1">&#39;meanu&#39;</span><span class="p">,</span> <span class="s1">&#39;meanv&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;gam0r&#39;</span><span class="p">,</span> <span class="s1">&#39;gam0i&#39;</span><span class="p">,</span> <span class="s1">&#39;gam1r&#39;</span><span class="p">,</span> <span class="s1">&#39;gam1i&#39;</span><span class="p">,</span> <span class="s1">&#39;gam2r&#39;</span><span class="p">,</span> <span class="s1">&#39;gam2i&#39;</span><span class="p">,</span> <span class="s1">&#39;gam3r&#39;</span><span class="p">,</span> <span class="s1">&#39;gam3i&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;sigma_gam0&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma_gam1&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma_gam2&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma_gam3&#39;</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">,</span> <span class="s1">&#39;ntri&#39;</span> <span class="p">]</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">meand1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meand2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd2</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">meand3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meanu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meanv</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gam0r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam0i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam1r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam1i</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gam2r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam2i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam3r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam3i</span><span class="p">,</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vargam0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vargam1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vargam2</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vargam3</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ntri</span> <span class="p">]</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;coords&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="s1">&#39;metric&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="p">,</span>
                   <span class="s1">&#39;sep_units&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sep_units</span><span class="p">,</span> <span class="s1">&#39;bin_type&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_type</span> <span class="p">}</span>

        <span class="k">if</span> <span class="n">precision</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">precision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;precision&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

        <span class="n">treecorr</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">gen_write</span><span class="p">(</span>
            <span class="n">file_name</span><span class="p">,</span> <span class="n">col_names</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span></div>


<div class="viewcode-block" id="GGGCorrelation.read"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read in values from a file.</span>

<span class="sd">        This should be a file that was written by TreeCorr, preferably a FITS file, so there</span>
<span class="sd">        is no loss of information.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            The `GGGCorrelation` object should be constructed with the same configuration</span>
<span class="sd">            parameters as the one being read.  e.g. the same min_sep, max_sep, etc.  This is not</span>
<span class="sd">            checked by the read function.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            file_name (str):    The name of the file to read in.</span>
<span class="sd">            file_type (str):    The type of file (&#39;ASCII&#39; or &#39;FITS&#39;).  (default: determine the type</span>
<span class="sd">                                automatically from the extension of file_name.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Reading GGG correlations from </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">file_name</span><span class="p">)</span>

        <span class="n">data</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">gen_read</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logr</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">if</span> <span class="s1">&#39;R_nom&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rnom</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;R_nom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rnom</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;r_nom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rnom</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;u_nom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;v_nom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;meand1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;meanlogd1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;meand2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;meanlogd2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand3</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;meand3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd3</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;meanlogd3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanu</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;meanu&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanv</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;meanv&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam0r</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gam0r&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam0i</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gam0i&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam1r</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gam1r&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam1i</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gam1i&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam2r</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gam2r&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam2i</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gam2i&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam3r</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gam3r&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam3i</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gam3i&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="c1"># Read old output files without error.</span>
        <span class="k">if</span> <span class="s1">&#39;sigma_gam&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vargam0</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sigma_gam&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vargam1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sigma_gam&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vargam2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sigma_gam&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vargam3</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sigma_gam&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vargam0</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sigma_gam0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vargam1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sigma_gam1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vargam2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sigma_gam2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vargam3</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sigma_gam3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ntri</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ntri&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;coords&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metric</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;metric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sep_units</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;sep_units&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bin_type</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;bin_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_calculateT</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">k3</span><span class="p">):</span>
        <span class="c1"># First calculate q values:</span>
        <span class="n">q1</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="o">+</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="mf">3.</span>
        <span class="n">q2</span> <span class="o">=</span> <span class="n">q1</span><span class="o">-</span><span class="n">t</span>
        <span class="n">q3</span> <span class="o">=</span> <span class="n">q1</span><span class="o">-</span><span class="n">s</span>

        <span class="c1"># |qi|^2 shows up a lot, so save these.</span>
        <span class="c1"># The a stands for &quot;absolute&quot;, and the ^2 part is implicit.</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">a3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">a123</span> <span class="o">=</span> <span class="n">a1</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">a3</span>

        <span class="c1"># These combinations also appear multiple times.</span>
        <span class="c1"># The b doesn&#39;t stand for anything.  It&#39;s just the next letter after a.</span>
        <span class="n">b1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">q2</span><span class="o">*</span><span class="n">q3</span>
        <span class="n">b2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">q1</span><span class="o">*</span><span class="n">q3</span>
        <span class="n">b3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">q1</span><span class="o">*</span><span class="n">q2</span>

        <span class="k">if</span> <span class="n">k1</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">k2</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">k3</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>

            <span class="c1"># Some factors we use multiple times</span>
            <span class="n">expfactor</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">a1</span> <span class="o">+</span> <span class="n">a2</span> <span class="o">+</span> <span class="n">a3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

            <span class="c1"># JBJ Equation 51</span>
            <span class="c1"># Note that we actually accumulate the Gammas with a different choice for</span>
            <span class="c1"># alpha_i.  We accumulate the shears relative to the q vectors, not relative to s.</span>
            <span class="c1"># cf. JBJ Equation 41 and footnote 3.  The upshot is that we multiply JBJ&#39;s formulae</span>
            <span class="c1"># be (q1q2q3)^2 / |q1q2q3|^2 for T0 and (q1*q2q3)^2/|q1q2q3|^2 for T1.</span>
            <span class="c1"># Then T0 becomes</span>
            <span class="c1"># T0 = -(|q1 q2 q3|^2)/24 exp(-(|q1|^2+|q2|^2+|q3|^2)/2)</span>
            <span class="n">T0</span> <span class="o">=</span> <span class="n">expfactor</span> <span class="o">*</span> <span class="n">a123</span> <span class="o">/</span> <span class="mi">24</span>

            <span class="c1"># JBJ Equation 52</span>
            <span class="c1"># After the phase adjustment, T1 becomes:</span>
            <span class="c1"># T1 = -[(|q1 q2 q3|^2)/24</span>
            <span class="c1">#        - (q1*^2 q2 q3)/9</span>
            <span class="c1">#        + (q1*^4 q2^2 q3^2 + 2 |q2 q3|^2 q1*^2 q2 q3)/(|q1 q2 q3|^2)/27</span>
            <span class="c1">#       ] exp(-(|q1|^2+|q2|^2+|q3|^2)/2)</span>
            <span class="n">T1</span> <span class="o">=</span> <span class="n">expfactor</span> <span class="o">*</span> <span class="p">(</span><span class="n">a123</span> <span class="o">/</span> <span class="mi">24</span> <span class="o">-</span> <span class="n">b1</span> <span class="o">/</span> <span class="mi">9</span> <span class="o">+</span> <span class="p">(</span><span class="n">b1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">a3</span><span class="o">*</span><span class="n">b1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a123</span> <span class="o">*</span> <span class="mi">27</span><span class="p">))</span>
            <span class="n">T2</span> <span class="o">=</span> <span class="n">expfactor</span> <span class="o">*</span> <span class="p">(</span><span class="n">a123</span> <span class="o">/</span> <span class="mi">24</span> <span class="o">-</span> <span class="n">b2</span> <span class="o">/</span> <span class="mi">9</span> <span class="o">+</span> <span class="p">(</span><span class="n">b2</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">a1</span><span class="o">*</span><span class="n">a3</span><span class="o">*</span><span class="n">b2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a123</span> <span class="o">*</span> <span class="mi">27</span><span class="p">))</span>
            <span class="n">T3</span> <span class="o">=</span> <span class="n">expfactor</span> <span class="o">*</span> <span class="p">(</span><span class="n">a123</span> <span class="o">/</span> <span class="mi">24</span> <span class="o">-</span> <span class="n">b3</span> <span class="o">/</span> <span class="mi">9</span> <span class="o">+</span> <span class="p">(</span><span class="n">b3</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">a1</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b3</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a123</span> <span class="o">*</span> <span class="mi">27</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># SKL Equation 63:</span>
            <span class="n">k1sq</span> <span class="o">=</span> <span class="n">k1</span><span class="o">*</span><span class="n">k1</span>
            <span class="n">k2sq</span> <span class="o">=</span> <span class="n">k2</span><span class="o">*</span><span class="n">k2</span>
            <span class="n">k3sq</span> <span class="o">=</span> <span class="n">k3</span><span class="o">*</span><span class="n">k3</span>
            <span class="n">Theta2</span> <span class="o">=</span> <span class="p">((</span><span class="n">k1sq</span><span class="o">*</span><span class="n">k2sq</span> <span class="o">+</span> <span class="n">k1sq</span><span class="o">*</span><span class="n">k3sq</span> <span class="o">+</span> <span class="n">k2sq</span><span class="o">*</span><span class="n">k3sq</span><span class="p">)</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
            <span class="n">k1sq</span> <span class="o">/=</span> <span class="n">Theta2</span>   <span class="c1"># These are now what SKL calls theta_i^2 / Theta^2</span>
            <span class="n">k2sq</span> <span class="o">/=</span> <span class="n">Theta2</span>
            <span class="n">k3sq</span> <span class="o">/=</span> <span class="n">Theta2</span>
            <span class="n">Theta4</span> <span class="o">=</span> <span class="n">Theta2</span><span class="o">*</span><span class="n">Theta2</span>
            <span class="n">Theta6</span> <span class="o">=</span> <span class="n">Theta4</span><span class="o">*</span><span class="n">Theta2</span>
            <span class="n">S</span> <span class="o">=</span> <span class="n">k1sq</span> <span class="o">*</span> <span class="n">k2sq</span> <span class="o">*</span> <span class="n">k3sq</span>

            <span class="c1"># SKL Equation 64:</span>
            <span class="n">Z</span> <span class="o">=</span> <span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">k2sq</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k3sq</span> <span class="o">-</span> <span class="n">k1sq</span><span class="p">)</span> <span class="o">*</span> <span class="n">a1</span> <span class="o">+</span>
                 <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k3sq</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k1sq</span> <span class="o">-</span> <span class="n">k2sq</span><span class="p">)</span> <span class="o">*</span> <span class="n">a2</span> <span class="o">+</span>
                 <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k1sq</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k2sq</span> <span class="o">-</span> <span class="n">k3sq</span><span class="p">)</span> <span class="o">*</span> <span class="n">a3</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">Theta2</span><span class="p">)</span>
            <span class="n">expfactor</span> <span class="o">=</span> <span class="o">-</span><span class="n">S</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">Z</span><span class="p">)</span> <span class="o">/</span> <span class="n">Theta4</span>

            <span class="c1"># SKL Equation 65:</span>
            <span class="n">f1</span> <span class="o">=</span> <span class="p">(</span><span class="n">k2sq</span><span class="o">+</span><span class="n">k3sq</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">k2sq</span><span class="o">-</span><span class="n">k3sq</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q2</span><span class="o">-</span><span class="n">q3</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">q1</span><span class="p">)</span>
            <span class="n">f2</span> <span class="o">=</span> <span class="p">(</span><span class="n">k3sq</span><span class="o">+</span><span class="n">k1sq</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">k3sq</span><span class="o">-</span><span class="n">k1sq</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q3</span><span class="o">-</span><span class="n">q1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">q2</span><span class="p">)</span>
            <span class="n">f3</span> <span class="o">=</span> <span class="p">(</span><span class="n">k1sq</span><span class="o">+</span><span class="n">k2sq</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">k1sq</span><span class="o">-</span><span class="n">k2sq</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q1</span><span class="o">-</span><span class="n">q2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">q3</span><span class="p">)</span>
            <span class="n">f1c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span>
            <span class="n">f2c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">f2</span><span class="p">)</span>
            <span class="n">f3c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">f3</span><span class="p">)</span>

            <span class="c1"># SKL Equation 69:</span>
            <span class="n">g1</span> <span class="o">=</span> <span class="n">k2sq</span><span class="o">*</span><span class="n">k3sq</span> <span class="o">+</span> <span class="p">(</span><span class="n">k3sq</span><span class="o">-</span><span class="n">k2sq</span><span class="p">)</span><span class="o">*</span><span class="n">k1sq</span><span class="o">*</span><span class="p">(</span><span class="n">q2</span><span class="o">-</span><span class="n">q3</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">q1</span><span class="p">)</span>
            <span class="n">g2</span> <span class="o">=</span> <span class="n">k3sq</span><span class="o">*</span><span class="n">k1sq</span> <span class="o">+</span> <span class="p">(</span><span class="n">k1sq</span><span class="o">-</span><span class="n">k3sq</span><span class="p">)</span><span class="o">*</span><span class="n">k2sq</span><span class="o">*</span><span class="p">(</span><span class="n">q3</span><span class="o">-</span><span class="n">q1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">q2</span><span class="p">)</span>
            <span class="n">g3</span> <span class="o">=</span> <span class="n">k1sq</span><span class="o">*</span><span class="n">k2sq</span> <span class="o">+</span> <span class="p">(</span><span class="n">k2sq</span><span class="o">-</span><span class="n">k1sq</span><span class="p">)</span><span class="o">*</span><span class="n">k3sq</span><span class="o">*</span><span class="p">(</span><span class="n">q1</span><span class="o">-</span><span class="n">q2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">q3</span><span class="p">)</span>
            <span class="n">g1c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">g1</span><span class="p">)</span>
            <span class="n">g2c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">g2</span><span class="p">)</span>
            <span class="n">g3c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">g3</span><span class="p">)</span>

            <span class="c1"># SKL Equation 62:</span>
            <span class="n">T0</span> <span class="o">=</span> <span class="n">expfactor</span> <span class="o">*</span> <span class="n">a123</span> <span class="o">*</span> <span class="n">f1c</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">f2c</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">f3c</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mf">24.</span><span class="o">*</span><span class="n">Theta6</span><span class="p">)</span>

            <span class="c1"># SKL Equation 68:</span>
            <span class="n">T1</span> <span class="o">=</span> <span class="n">expfactor</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">a123</span> <span class="o">*</span> <span class="n">f1</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">f2c</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">f3c</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="n">Theta6</span><span class="p">)</span> <span class="o">-</span>
                <span class="n">b1</span> <span class="o">*</span> <span class="n">f1</span><span class="o">*</span><span class="n">f2c</span><span class="o">*</span><span class="n">f3c</span><span class="o">*</span><span class="n">g1c</span> <span class="o">/</span> <span class="p">(</span><span class="mi">9</span><span class="o">*</span><span class="n">Theta4</span><span class="p">)</span> <span class="o">+</span>
                <span class="p">(</span><span class="n">b1</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">g1c</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k2sq</span><span class="o">*</span><span class="n">k3sq</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">a3</span><span class="o">*</span><span class="n">b1</span> <span class="o">*</span> <span class="n">f2c</span> <span class="o">*</span> <span class="n">f3c</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a123</span> <span class="o">*</span> <span class="mi">27</span><span class="o">*</span><span class="n">Theta2</span><span class="p">))</span>
            <span class="n">T2</span> <span class="o">=</span> <span class="n">expfactor</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">a123</span> <span class="o">*</span> <span class="n">f1c</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">f2</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">f3c</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="n">Theta6</span><span class="p">)</span> <span class="o">-</span>
                <span class="n">b2</span> <span class="o">*</span> <span class="n">f1c</span><span class="o">*</span><span class="n">f2</span><span class="o">*</span><span class="n">f3c</span><span class="o">*</span><span class="n">g2c</span> <span class="o">/</span> <span class="p">(</span><span class="mi">9</span><span class="o">*</span><span class="n">Theta4</span><span class="p">)</span> <span class="o">+</span>
                <span class="p">(</span><span class="n">b2</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">g2c</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k1sq</span><span class="o">*</span><span class="n">k3sq</span><span class="o">*</span><span class="n">a1</span><span class="o">*</span><span class="n">a3</span><span class="o">*</span><span class="n">b2</span> <span class="o">*</span> <span class="n">f1c</span> <span class="o">*</span> <span class="n">f3c</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a123</span> <span class="o">*</span> <span class="mi">27</span><span class="o">*</span><span class="n">Theta2</span><span class="p">))</span>
            <span class="n">T3</span> <span class="o">=</span> <span class="n">expfactor</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">a123</span> <span class="o">*</span> <span class="n">f1c</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">f2c</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">f3</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="n">Theta6</span><span class="p">)</span> <span class="o">-</span>
                <span class="n">b3</span> <span class="o">*</span> <span class="n">f1c</span><span class="o">*</span><span class="n">f2c</span><span class="o">*</span><span class="n">f3</span><span class="o">*</span><span class="n">g3c</span> <span class="o">/</span> <span class="p">(</span><span class="mi">9</span><span class="o">*</span><span class="n">Theta4</span><span class="p">)</span> <span class="o">+</span>
                <span class="p">(</span><span class="n">b3</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">g3c</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k1sq</span><span class="o">*</span><span class="n">k2sq</span><span class="o">*</span><span class="n">a1</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b3</span> <span class="o">*</span> <span class="n">f1c</span> <span class="o">*</span> <span class="n">f2c</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a123</span> <span class="o">*</span> <span class="mi">27</span><span class="o">*</span><span class="n">Theta2</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">,</span> <span class="n">T3</span>


<div class="viewcode-block" id="GGGCorrelation.calculateMap3"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.calculateMap3">[docs]</a>    <span class="k">def</span> <span class="nf">calculateMap3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">k2</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">k3</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the skewness of the aperture mass from the correlation function.</span>

<span class="sd">        The equations for this come from Jarvis, Bernstein &amp; Jain (2004, MNRAS, 352).</span>
<span class="sd">        See their section 3, especially equations 51 and 52 for the :math:`T_i` functions,</span>
<span class="sd">        equations 60 and 61 for the calculation of :math:`\langle \cal M^3 \rangle` and</span>
<span class="sd">        :math:`\langle \cal M^2 M^* \rangle`, and equations 55-58 for how to convert</span>
<span class="sd">        these to the return values.</span>

<span class="sd">        If k2 or k3 != 1, then this routine calculates the generalization of the skewness</span>
<span class="sd">        proposed by Schneider, Kilbinger &amp; Lombardi (2005, A&amp;A, 431):</span>
<span class="sd">        :math:`\langle M_{ap}^3(R, k_2 R, k_3 R)\rangle` and related values.</span>

<span class="sd">        If k2 = k3 = 1 (the default), then there are only 4 combinations of Map and Mx</span>
<span class="sd">        that are relevant:</span>

<span class="sd">        - map3 = :math:`\langle M_{ap}^3(R)\rangle`</span>
<span class="sd">        - map2mx = :math:`\langle M_{ap}^2(R) M_\times(R)\rangle`,</span>
<span class="sd">        - mapmx2 = :math:`\langle M_{ap}(R) M_\times(R)\rangle`</span>
<span class="sd">        - mx3 = :math:`\langle M_{\rm \times}^3(R)\rangle`</span>

<span class="sd">        However, if k2 or k3 != 1, then there are 8 combinations:</span>

<span class="sd">        - map3 = :math:`\langle M_{ap}(R) M_{ap}(k_2 R) M_{ap}(k_3 R)\rangle`</span>
<span class="sd">        - mapmapmx = :math:`\langle M_{ap}(R) M_{ap}(k_2 R) M_\times(k_3 R)\rangle`</span>
<span class="sd">        - mapmxmap = :math:`\langle M_{ap}(R) M_\times(k_2 R) M_{ap}(k_3 R)\rangle`</span>
<span class="sd">        - mxmapmap = :math:`\langle M_\times(R) M_{ap}(k_2 R) M_{ap}(k_3 R)\rangle`</span>
<span class="sd">        - mxmxmap = :math:`\langle M_\times(R) M_\times(k_2 R) M_{ap}(k_3 R)\rangle`</span>
<span class="sd">        - mxmapmx = :math:`\langle M_\times(R) M_{ap}(k_2 R) M_\times(k_3 R)\rangle`</span>
<span class="sd">        - mapmxmx = :math:`\langle M_{ap}(R) M_\times(k_2 R) M_\times(k_3 R)\rangle`</span>
<span class="sd">        - mx3 = :math:`\langle M_\times(R) M_\times(k_2 R) M_\times(k_3 R)\rangle`</span>

<span class="sd">        To accommodate this full generality, we always return all 8 values, along with the</span>
<span class="sd">        estimated variance (which is equal for each), even when k2 = k3 = 1.</span>

<span class="sd">        .. note::</span>

<span class="sd">            The formulae for the ``m2_uform`` = &#39;Schneider&#39; definition of the aperture mass,</span>
<span class="sd">            described in the documentation of `calculateMapSq`, are not known, so that is not an</span>
<span class="sd">            option here.  The calculations here use the definition that corresponds to</span>
<span class="sd">            ``m2_uform`` = &#39;Crittenden&#39;.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            R (array):      The R values at which to calculate the aperture mass statistics.</span>
<span class="sd">                            (default: None, which means use self.rnom1d)</span>
<span class="sd">            k2 (float):     If given, the ratio R2/R1 in the SKL formulae. (default: 1)</span>
<span class="sd">            k3 (float):     If given, the ratio R3/R1 in the SKL formulae. (default: 1)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple containing</span>

<span class="sd">                - map3 = array of :math:`\langle M_{ap}(R) M_{ap}(k_2 R) M_{ap}(k_3 R)\rangle`</span>
<span class="sd">                - mapmapmx = array of :math:`\langle M_{ap}(R) M_{ap}(k_2 R) M_\times(k_3 R)\rangle`</span>
<span class="sd">                - mapmxmap = array of :math:`\langle M_{ap}(R) M_\times(k_2 R) M_{ap}(k_3 R)\rangle`</span>
<span class="sd">                - mxmapmap = array of :math:`\langle M_\times(R) M_{ap}(k_2 R) M_{ap}(k_3 R)\rangle`</span>
<span class="sd">                - mxmxmap = array of :math:`\langle M_\times(R) M_\times(k_2 R) M_{ap}(k_3 R)\rangle`</span>
<span class="sd">                - mxmapmx = array of :math:`\langle M_\times(R) M_{ap}(k_2 R) M_\times(k_3 R)\rangle`</span>
<span class="sd">                - mapmxmx = array of :math:`\langle M_{ap}(R) M_\times(k_2 R) M_\times(k_3 R)\rangle`</span>
<span class="sd">                - mx3 = array of :math:`\langle M_\times(R) M_\times(k_2 R) M_\times(k_3 R)\rangle`</span>
<span class="sd">                - varmap3 = array of variance estimates of the above values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># As in the calculateMapSq function, we Make s and t matrices, so we can eventually do the</span>
        <span class="c1"># integral by doing a matrix product.</span>
        <span class="k">if</span> <span class="n">R</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnom1d</span>

        <span class="c1"># Pick s = d2, so dlogs is bin_size</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meand2</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meanu</span> <span class="o">&gt;=</span> <span class="mf">0.9</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meanv</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meanv</span> <span class="o">&lt;=</span> <span class="mf">0.1</span><span class="p">)</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="c1"># We take t = d3, but we need the x and y components. (relative to s along x axis)</span>
        <span class="c1"># cf. Figure 1 in JBJ.</span>
        <span class="c1"># d1^2 = d2^2 + d3^2 - 2 d2 d3 cos(theta1)</span>
        <span class="c1"># tx = d3 cos(theta1) = (d2^2 + d3^2 - d1^2)/2d2</span>
        <span class="n">d3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meand3</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meand1</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
        <span class="n">tx</span> <span class="o">=</span> <span class="p">(</span><span class="n">d2</span><span class="o">*</span><span class="n">d2</span> <span class="o">+</span> <span class="n">d3</span><span class="o">*</span><span class="n">d3</span> <span class="o">-</span> <span class="n">d1</span><span class="o">*</span><span class="n">d1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">d2</span><span class="p">)</span>
        <span class="n">ty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d3</span><span class="o">*</span><span class="n">d3</span> <span class="o">-</span> <span class="n">tx</span><span class="o">*</span><span class="n">tx</span><span class="p">)</span>
        <span class="n">ty</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">meanv</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mf">1.</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">tx</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">ty</span>

        <span class="c1"># Next we need to construct the T values.</span>
        <span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">,</span> <span class="n">T3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculateT</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="n">k2</span><span class="p">,</span><span class="n">k3</span><span class="p">)</span>

        <span class="c1"># Finally, account for the Jacobian in d^2t: jac = |J(tx, ty; u, v)|,</span>
        <span class="c1"># since our Gammas are accumulated in s, u, v, not s, tx, ty.</span>
        <span class="c1"># u = d3/d2, v = (d1-d2)/d3</span>
        <span class="c1"># tx = (s^2 + (s u)^2 - (s u v + s)^2)/2s</span>
        <span class="c1">#    = s/2 (1 + u^2 - (1 + 2uv + u^2v^2))</span>
        <span class="c1">#    = s/2 (u^2 - 2uv - u^2 v^2)</span>
        <span class="c1"># dtx/du = s (u - v - uv^2)</span>
        <span class="c1"># dtx/dv = -us (1 + uv)</span>
        <span class="c1"># ty = sqrt(d3^2 - tx^2) = sqrt(u^2 s^2 - tx^2)</span>
        <span class="c1"># dty/du = s^2 u/2ty (1-v^2) (2 + 3uv - u^2 + u^2v^2)</span>
        <span class="c1"># dty/dv = s^2 u^2/2ty (1 + uv) (u - uv^2 - 2uv)</span>
        <span class="c1">#</span>
        <span class="c1"># After some algebra...</span>
        <span class="c1">#</span>
        <span class="c1"># J = s^3 u^2 (1+uv) / ty</span>
        <span class="c1">#   = d3^2 d1 / ty</span>
        <span class="n">jac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">d3</span><span class="o">*</span><span class="n">d3</span><span class="o">*</span><span class="n">d1</span><span class="o">/</span><span class="n">ty</span><span class="p">)</span>
        <span class="n">d2t</span> <span class="o">=</span> <span class="n">jac</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ubin_size</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vbin_size</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">sds</span> <span class="o">=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">s</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_size</span>  <span class="c1"># Remember bin_size is dln(s)</span>
        <span class="c1"># Note: these are really d2t/2piR^2 and sds/R^2, which are what actually show up</span>
        <span class="c1"># in JBJ equations 45 and 50.</span>

        <span class="n">T0</span> <span class="o">*=</span> <span class="n">sds</span> <span class="o">*</span> <span class="n">d2t</span>
        <span class="n">T1</span> <span class="o">*=</span> <span class="n">sds</span> <span class="o">*</span> <span class="n">d2t</span>
        <span class="n">T2</span> <span class="o">*=</span> <span class="n">sds</span> <span class="o">*</span> <span class="n">d2t</span>
        <span class="n">T3</span> <span class="o">*=</span> <span class="n">sds</span> <span class="o">*</span> <span class="n">d2t</span>

        <span class="c1"># Now do the integral by taking the matrix products.</span>
        <span class="n">gam0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam0</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">gam1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam1</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">gam2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam2</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">gam3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam3</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">vargam0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vargam0</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">vargam1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vargam1</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">vargam2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vargam2</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">vargam3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vargam3</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">mmm</span> <span class="o">=</span> <span class="n">T0</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">gam0</span><span class="p">)</span>
        <span class="n">mcmm</span> <span class="o">=</span> <span class="n">T1</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">gam1</span><span class="p">)</span> <span class="o">+</span> <span class="n">T2</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">gam2</span><span class="p">)</span> <span class="o">+</span> <span class="n">T3</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">gam3</span><span class="p">)</span>
        <span class="n">varmmm</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">T0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vargam0</span><span class="p">)</span>
        <span class="n">varmcmm</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">T1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vargam1</span><span class="p">)</span>
        <span class="n">varmcmm</span> <span class="o">+=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">T2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vargam2</span><span class="p">)</span>
        <span class="n">varmcmm</span> <span class="o">+=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">T3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vargam3</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">k2</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">k3</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">mmm</span> <span class="o">*=</span> <span class="mi">6</span>
            <span class="n">varmmm</span> <span class="o">*=</span> <span class="mi">6</span>
            <span class="n">mcmm</span> <span class="o">*=</span> <span class="mi">2</span>
            <span class="n">mmcm</span> <span class="o">=</span> <span class="n">mmmc</span> <span class="o">=</span> <span class="n">mcmm</span>
            <span class="n">varmcmm</span> <span class="o">*=</span> <span class="mi">2</span>
            <span class="n">varmmcm</span> <span class="o">=</span> <span class="n">varmmmc</span> <span class="o">=</span> <span class="n">varmcmm</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Repeat the above for the other permutations</span>
            <span class="n">mmcm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">mcmm</span><span class="p">)</span>
            <span class="n">mmmc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">mcmm</span><span class="p">)</span>
            <span class="n">varmmcm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">varmcmm</span><span class="p">)</span>
            <span class="n">varmmmc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">varmcmm</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">_k1</span><span class="p">,</span> <span class="n">_k2</span><span class="p">,</span> <span class="n">_k3</span><span class="p">,</span> <span class="n">_mcmm</span><span class="p">,</span> <span class="n">_varmcmm</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k3</span><span class="p">,</span><span class="n">k2</span><span class="p">,</span><span class="n">mcmm</span><span class="p">,</span><span class="n">varmcmm</span><span class="p">),</span>
                                                      <span class="p">(</span><span class="n">k2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">k3</span><span class="p">,</span><span class="n">mmcm</span><span class="p">,</span><span class="n">varmmcm</span><span class="p">),</span>
                                                      <span class="p">(</span><span class="n">k2</span><span class="p">,</span><span class="n">k3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">mmcm</span><span class="p">,</span><span class="n">varmmcm</span><span class="p">),</span>
                                                      <span class="p">(</span><span class="n">k3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">k2</span><span class="p">,</span><span class="n">mmmc</span><span class="p">,</span><span class="n">varmmmc</span><span class="p">),</span>
                                                      <span class="p">(</span><span class="n">k3</span><span class="p">,</span><span class="n">k2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">mmmc</span><span class="p">,</span><span class="n">varmmmc</span><span class="p">)</span> <span class="p">]:</span>
                <span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">,</span> <span class="n">T3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculateT</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">_k1</span><span class="p">,</span><span class="n">_k2</span><span class="p">,</span><span class="n">_k3</span><span class="p">)</span>
                <span class="n">T0</span> <span class="o">*=</span> <span class="n">sds</span> <span class="o">*</span> <span class="n">d2t</span>
                <span class="n">T1</span> <span class="o">*=</span> <span class="n">sds</span> <span class="o">*</span> <span class="n">d2t</span>
                <span class="n">T2</span> <span class="o">*=</span> <span class="n">sds</span> <span class="o">*</span> <span class="n">d2t</span>
                <span class="n">T3</span> <span class="o">*=</span> <span class="n">sds</span> <span class="o">*</span> <span class="n">d2t</span>
                <span class="c1"># Relies on numpy array overloading += to actually update in place.</span>
                <span class="n">mmm</span> <span class="o">+=</span> <span class="n">T0</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">gam0</span><span class="p">)</span>
                <span class="n">_mcmm</span> <span class="o">+=</span> <span class="n">T1</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">gam1</span><span class="p">)</span> <span class="o">+</span> <span class="n">T2</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">gam2</span><span class="p">)</span> <span class="o">+</span> <span class="n">T3</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">gam3</span><span class="p">)</span>
                <span class="n">varmmm</span> <span class="o">+=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">T0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vargam0</span><span class="p">)</span>
                <span class="n">_varmcmm</span> <span class="o">+=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">T1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vargam1</span><span class="p">)</span>
                <span class="n">_varmcmm</span> <span class="o">+=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">T2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vargam2</span><span class="p">)</span>
                <span class="n">_varmcmm</span> <span class="o">+=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">T3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vargam3</span><span class="p">)</span>

        <span class="n">map3</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">mcmm</span> <span class="o">+</span> <span class="n">mmcm</span> <span class="o">+</span> <span class="n">mmmc</span> <span class="o">+</span> <span class="n">mmm</span><span class="p">)</span>
        <span class="n">mapmapmx</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">mcmm</span> <span class="o">+</span> <span class="n">mmcm</span> <span class="o">-</span> <span class="n">mmmc</span> <span class="o">+</span> <span class="n">mmm</span><span class="p">)</span>
        <span class="n">mapmxmap</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">mcmm</span> <span class="o">-</span> <span class="n">mmcm</span> <span class="o">+</span> <span class="n">mmmc</span> <span class="o">+</span> <span class="n">mmm</span><span class="p">)</span>
        <span class="n">mxmapmap</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="o">-</span><span class="n">mcmm</span> <span class="o">+</span> <span class="n">mmcm</span> <span class="o">+</span> <span class="n">mmmc</span> <span class="o">+</span> <span class="n">mmm</span><span class="p">)</span>
        <span class="n">mxmxmap</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">mcmm</span> <span class="o">+</span> <span class="n">mmcm</span> <span class="o">-</span> <span class="n">mmmc</span> <span class="o">-</span> <span class="n">mmm</span><span class="p">)</span>
        <span class="n">mxmapmx</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">mcmm</span> <span class="o">-</span> <span class="n">mmcm</span> <span class="o">+</span> <span class="n">mmmc</span> <span class="o">-</span> <span class="n">mmm</span><span class="p">)</span>
        <span class="n">mapmxmx</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="o">-</span><span class="n">mcmm</span> <span class="o">+</span> <span class="n">mmcm</span> <span class="o">+</span> <span class="n">mmmc</span> <span class="o">-</span> <span class="n">mmm</span><span class="p">)</span>
        <span class="n">mx3</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">mcmm</span> <span class="o">+</span> <span class="n">mmcm</span> <span class="o">+</span> <span class="n">mmmc</span> <span class="o">-</span> <span class="n">mmm</span><span class="p">)</span>

        <span class="n">var</span> <span class="o">=</span> <span class="p">(</span><span class="n">varmcmm</span> <span class="o">+</span> <span class="n">varmmcm</span> <span class="o">+</span> <span class="n">varmmmc</span> <span class="o">+</span> <span class="n">varmmm</span><span class="p">)</span> <span class="o">/</span> <span class="mf">16.</span>

        <span class="k">return</span> <span class="n">map3</span><span class="p">,</span> <span class="n">mapmapmx</span><span class="p">,</span> <span class="n">mapmxmap</span><span class="p">,</span> <span class="n">mxmapmap</span><span class="p">,</span> <span class="n">mxmxmap</span><span class="p">,</span> <span class="n">mxmapmx</span><span class="p">,</span> <span class="n">mapmxmx</span><span class="p">,</span> <span class="n">mx3</span><span class="p">,</span> <span class="n">var</span></div>

<div class="viewcode-block" id="GGGCorrelation.writeMap3"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.writeMap3">[docs]</a>    <span class="k">def</span> <span class="nf">writeMap3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Write the aperture mass skewness based on the correlation function to the</span>
<span class="sd">        file, file_name.</span>

<span class="sd">        The output file will include the following columns:</span>

<span class="sd">        ==========      ==========================================================</span>
<span class="sd">        Column          Description</span>
<span class="sd">        ==========      ==========================================================</span>
<span class="sd">        R               The aperture radius</span>
<span class="sd">        Map3            An estimate of :math:`\langle M_{ap}^3\rangle(R)`</span>
<span class="sd">                        (cf. `calculateMap3`)</span>
<span class="sd">        Map2Mx          An estimate of :math:`\langle M_{ap}^2 M_\times\rangle(R)`</span>
<span class="sd">        MapMx2          An estimate of :math:`\langle M_{ap} M_\times^2\rangle(R)`</span>
<span class="sd">        Mx3             An estimate of :math:`\langle M_\times^3\rangle(R)`</span>
<span class="sd">        sig_map         The sqrt of the variance estimate of each of these</span>
<span class="sd">        ==========      ==========================================================</span>

<span class="sd">        Parameters:</span>
<span class="sd">            file_name (str):    The name of the file to write to.</span>
<span class="sd">            R (array):          The R values at which to calculate the statistics.</span>
<span class="sd">                                (default: None, which means use self.rnom)</span>
<span class="sd">            file_type (str):    The type of file to write (&#39;ASCII&#39; or &#39;FITS&#39;).  (default: determine</span>
<span class="sd">                                the type automatically from the extension of file_name.)</span>
<span class="sd">            precision (int):    For ASCII output catalogs, the desired precision. (default: 4;</span>
<span class="sd">                                this value can also be given in the constructor in the config dict.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Writing Map^3 from GGG correlations to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">file_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">R</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnom1d</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculateMap3</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">precision</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">precision</span> <span class="o">=</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span><span class="s1">&#39;precision&#39;</span><span class="p">,</span><span class="nb">int</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>

        <span class="n">treecorr</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">gen_write</span><span class="p">(</span>
            <span class="n">file_name</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="s1">&#39;Map3&#39;</span><span class="p">,</span><span class="s1">&#39;Map2Mx&#39;</span><span class="p">,</span> <span class="s1">&#39;MapMx2&#39;</span><span class="p">,</span> <span class="s1">&#39;Mx3&#39;</span><span class="p">,</span><span class="s1">&#39;sig_map&#39;</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">R</span><span class="p">,</span> <span class="n">stats</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span> <span class="p">],</span>
            <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Mike Jarvis

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>