

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Changes from version 4.0 to 4.1 &mdash; TreeCorr 4.1.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Previous History" href="history.html" />
    <link rel="prev" title="Getting Started Guide" href="guide.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> TreeCorr
          

          
          </a>

          
            
            
              <div class="version">
                4.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="catalog.html">Input Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="correlation2.html">Two-point Correlation Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="correlation3.html">Three-point Correlation Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="metric.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="binning.html">Binning</a></li>
<li class="toctree-l1"><a class="reference internal" href="patches.html">Patches</a></li>
<li class="toctree-l1"><a class="reference internal" href="cov.html">Covariance Estimates</a></li>
<li class="toctree-l1"><a class="reference internal" href="field.html">Fields</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripts.html">Using configuration files</a></li>
<li class="toctree-l1"><a class="reference internal" href="params.html">Configuration Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="guide.html">Getting Started Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Changes from version 4.0 to 4.1</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#output-format-changes">Output Format Changes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#performance-improvements">Performance Improvements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#new-features">New features</a></li>
<li class="toctree-l2"><a class="reference internal" href="#deprecations">Deprecations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bug-fixes">Bug Fixes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#changes-from-version-4-1-0-to-4-1-1">Changes from version 4.1.0 to 4.1.1</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="history.html">Previous History</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">TreeCorr</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Changes from version 4.0 to 4.1</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/changes.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="changes-from-version-4-0-to-4-1">
<h1>Changes from version 4.0 to 4.1<a class="headerlink" href="#changes-from-version-4-0-to-4-1" title="Permalink to this headline">¶</a></h1>
<p>This release mostly adds the ability to compute jackknife and other estimates of
the variance (or covariance matrix), which do a better job of capturing sample
variance than the default (and previously only) method of computing just the
shot noise component.</p>
<p>This requires dividing the input Catalog into patches, which can be done by:</p>
<ol class="arabic simple">
<li><p>Giving patch numbers explicitly for each galaxy.</p></li>
<li><p>Having TreeCorr split it into some number of patches for you automatically (using K-Means).</p></li>
<li><p>Giving the patch centers to use, which will assign each galaxy to the patch corresponding
to the nearest center position.</p></li>
</ol>
<p>For more details about making patches, see <a class="reference external" href="https://rmjarvis.github.io/TreeCorr/_build/html/patches.html">Patches</a></p>
<p>For details about using patches to compute better covariance matrices,
see <a class="reference external" href="https://rmjarvis.github.io/TreeCorr/_build/html/cov.html">Covariance Estimates</a></p>
<p><a class="reference external" href="https://github.com/rmjarvis/TreeCorr/issues?q=milestone%3A%22Version+4.1%22+is%3Aclosed">Relevant PRs and Issues,</a>
whose issue numbers are listed below for the relevant items.</p>
<div class="section" id="output-format-changes">
<h2>Output Format Changes<a class="headerlink" href="#output-format-changes" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>When writing an <a class="reference internal" href="nn.html#treecorr.NNCorrelation" title="treecorr.NNCorrelation"><code class="xref any py py-class docutils literal notranslate"><span class="pre">NNCorrelation</span></code></a> to a file, if <a class="reference internal" href="nn.html#treecorr.NNCorrelation.calculateXi" title="treecorr.NNCorrelation.calculateXi"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">NNCorrelation.calculateXi</span></code></a> has
already been called, then the calculated <code class="docutils literal notranslate"><span class="pre">xi</span></code> and <code class="docutils literal notranslate"><span class="pre">varxi</span></code> will be written
to the output file, even if you don’t provide the random catalog to the
<a class="reference internal" href="nn.html#treecorr.NNCorrelation.write" title="treecorr.NNCorrelation.write"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">NNCorrelation.write</span></code></a> function. (#99)</p></li>
<li><p>Similarly, if <a class="reference internal" href="ng.html#treecorr.NGCorrelation.calculateXi" title="treecorr.NGCorrelation.calculateXi"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">NGCorrelation.calculateXi</span></code></a> or <a class="reference internal" href="nk.html#treecorr.NKCorrelation.calculateXi" title="treecorr.NKCorrelation.calculateXi"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">NKCorrelation.calculateXi</span></code></a> has
been called using a random catalog, then the <code class="docutils literal notranslate"><span class="pre">xi</span></code> and <code class="docutils literal notranslate"><span class="pre">varxi</span></code> columns in
the output file will be the compensated statistics, rather than the raw ones.
(#99)</p></li>
</ul>
</div>
<div class="section" id="performance-improvements">
<h2>Performance Improvements<a class="headerlink" href="#performance-improvements" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Improved the speed of reading in FITS files, mostly by telling fitsio to read
all of the columns at once rather than doing them one at a time. (#104)</p></li>
<li><p>Delayed the loading of Catalogs from files until the data is actually needed.
Specifically, if the full catalog is never needed, and only patches are used,
then this allows for a much reduced memory footprint with a new <code class="docutils literal notranslate"><span class="pre">low_mem</span></code>
option for <code class="docutils literal notranslate"><span class="pre">process</span></code> calls. (#103)</p></li>
<li><p>Added OpenMP parallelization to the (ra,dec) -&gt; (x,y,z) calculation to speed
up that step during Catalog loading. (#104)</p></li>
</ul>
</div>
<div class="section" id="new-features">
<h2>New features<a class="headerlink" href="#new-features" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Added <a class="reference internal" href="field.html#treecorr.Field.run_kmeans" title="treecorr.Field.run_kmeans"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">Field.run_kmeans</span></code></a> to run K-Means algorithm on a Field to determine a
good set of patches to use.  This will be run automatically simply by setting
<code class="docutils literal notranslate"><span class="pre">npatch</span></code> when building a <a class="reference internal" href="catalog.html#treecorr.Catalog" title="treecorr.Catalog"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Catalog</span></code></a>. (#88)</p></li>
<li><p>Added ability to input patch numbers from input file or input arrays using
<code class="docutils literal notranslate"><span class="pre">patch_col</span></code> or <code class="docutils literal notranslate"><span class="pre">patch</span></code> respectively. (#96)</p></li>
<li><p>Added ability to write patch centers to a file with <a class="reference internal" href="catalog.html#treecorr.Catalog.write_patch_centers" title="treecorr.Catalog.write_patch_centers"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">Catalog.write_patch_centers</span></code></a>.
(#99)</p></li>
<li><p>Added ability to define patch numbers from patch centers (either a file or
the <code class="docutils literal notranslate"><span class="pre">patch_centers</span></code> attribute of another Catalog). (#99)</p></li>
<li><p>Added the ability to compute jackknife, sample, bootstrap, and marked bootstrap
variance and covariance estimates by dividing the full calculation into
correlations across patches.  Set <code class="docutils literal notranslate"><span class="pre">var_method</span></code> in the Correlation class or
use the <a class="reference internal" href="correlation2.html#treecorr.BinnedCorr2.estimate_cov" title="treecorr.BinnedCorr2.estimate_cov"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">BinnedCorr2.estimate_cov</span></code></a> method. (#24, #50, #96)</p></li>
<li><p>Added <a class="reference internal" href="correlation2.html#treecorr.estimate_multi_cov" title="treecorr.estimate_multi_cov"><code class="xref any py py-func docutils literal notranslate"><span class="pre">estimate_multi_cov</span></code></a> function, which will the compute covariance
matrix across multiple statistics that have been run using the same set of patches.
(#96)</p></li>
<li><p>Added <code class="docutils literal notranslate"><span class="pre">every_nth</span></code> option for Catalogs to read in a fraction of the rows.  (#99)</p></li>
<li><p>After calling <a class="reference internal" href="nn.html#treecorr.NNCorrelation.calculateXi" title="treecorr.NNCorrelation.calculateXi"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">NNCorrelation.calculateXi</span></code></a>, the calculated <code class="docutils literal notranslate"><span class="pre">xi</span></code>, <code class="docutils literal notranslate"><span class="pre">varxi</span></code> and
<code class="docutils literal notranslate"><span class="pre">cov</span></code> are available as attributes. (#99)</p></li>
<li><p>Added <code class="docutils literal notranslate"><span class="pre">keep_zero_weight</span></code> option to include wpos=0 objects in the total npairs
if you want.  The default is to throw out wpos=0 objects at the start, but there
may be reasons to keep them, so that’s now an option when building the Catalog.
(#99)</p></li>
<li><p>Added <code class="docutils literal notranslate"><span class="pre">allow_xyz</span></code> option to allow x,y,z columns be provided along with ra,dec
columns.  Normally this is not allowed, but if you know they are consistent,
then this option allows them to be input directly to avoid recalculating them.
(#103)</p></li>
<li><p>Added <code class="docutils literal notranslate"><span class="pre">low_mem</span></code> option to <code class="docutils literal notranslate"><span class="pre">process</span></code> calls to unload patches that aren’t being
used, thus saving memory at the expense of some extra I/O time. (#103)</p></li>
<li><p>Added <code class="docutils literal notranslate"><span class="pre">save_patch_dir</span></code> as an optional location to write patch catalogs for increased
efficiency when using <code class="docutils literal notranslate"><span class="pre">low_mem</span></code> option. (#103)</p></li>
<li><p>Added <code class="docutils literal notranslate"><span class="pre">comm</span></code> option to <code class="docutils literal notranslate"><span class="pre">process</span></code> calls to use MPI to split a job up over
multiple machines. (#98, #104)</p></li>
</ul>
</div>
<div class="section" id="deprecations">
<h2>Deprecations<a class="headerlink" href="#deprecations" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>The <a class="reference internal" href="nn.html#treecorr.NNCorrelation.process_pairwise" title="treecorr.NNCorrelation.process_pairwise"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">process_pairwise</span></code></a> functions have all been
deprecated.  I can’t remember anymore why I added this feature, and I don’t think
anyone uses it (or the associated <a class="reference internal" href="field.html#treecorr.NSimpleField" title="treecorr.NSimpleField"><code class="xref any py py-class docutils literal notranslate"><span class="pre">SimpleFields</span></code></a>).  If you need this
functionality, please open an issue to let me know, and I can keep them.  Otherwise,
I’ll remove them as usesless cruft.</p></li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h2>Bug Fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Fixed a bug in 3-point calculations that could cause “Failed Assert: kr &lt; _nbins”.</p></li>
</ul>
</div>
<div class="section" id="changes-from-version-4-1-0-to-4-1-1">
<h2>Changes from version 4.1.0 to 4.1.1<a class="headerlink" href="#changes-from-version-4-1-0-to-4-1-1" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Make sure ra,dec,r catalogs make patches using just ra,dec, not full 3D position.</p></li>
<li><p>Fix a bug when using ra,dec,r catalog with <code class="docutils literal notranslate"><span class="pre">save_patch_dir</span></code> option.</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="history.html" class="btn btn-neutral float-right" title="Previous History" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="guide.html" class="btn btn-neutral float-left" title="Getting Started Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Mike Jarvis

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>