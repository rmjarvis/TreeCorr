<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Getting Started Guide &mdash; TreeCorr 4.3.0 documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Changes from version 4.2 to 4.3" href="changes.html" />
    <link rel="prev" title="Configuration Parameters" href="params.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> TreeCorr
          </a>
              <div class="version">
                4.3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="catalog.html">Input Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="correlation2.html">Two-point Correlation Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="correlation3.html">Three-point Correlation Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="metric.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="binning.html">Binning</a></li>
<li class="toctree-l1"><a class="reference internal" href="patches.html">Patches</a></li>
<li class="toctree-l1"><a class="reference internal" href="cov.html">Covariance Estimates</a></li>
<li class="toctree-l1"><a class="reference internal" href="field.html">Fields</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripts.html">Using configuration files</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting Started Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#jupyter-tutorial">Jupyter Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="#shear-shear-auto-correlation">Shear-shear auto-correlation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#other-two-point-correlation-classes">Other Two-point Correlation Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#loading-a-catalog">Loading a Catalog</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-a-catalog-from-numpy-arrays">Building a Catalog from numpy arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="#defining-the-binning">Defining the binning</a></li>
<li class="toctree-l2"><a class="reference internal" href="#three-point-correlation-classes">Three-point Correlation Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-random-catalogs">Using random catalogs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#manually-accumulating-the-correlation-function">Manually accumulating the correlation function</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="changes.html">Changes from version 4.2 to 4.3</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">Previous History</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">TreeCorr</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Getting Started Guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/guide.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="getting-started-guide">
<h1>Getting Started Guide<a class="headerlink" href="#getting-started-guide" title="Permalink to this headline">¶</a></h1>
<div class="section" id="jupyter-tutorial">
<h2>Jupyter Tutorial<a class="headerlink" href="#jupyter-tutorial" title="Permalink to this headline">¶</a></h2>
<p>The below page covers many of the same points as the
<a class="reference external" href="https://github.com/rmjarvis/TreeCorr/blob/main/tests/Tutorial.ipynb">Jupyter notebook tutorial</a>
available in the TreeCorr repo.
You may find it useful to work through that as well as, or instead of, reading this guide.</p>
</div>
<div class="section" id="shear-shear-auto-correlation">
<h2>Shear-shear auto-correlation<a class="headerlink" href="#shear-shear-auto-correlation" title="Permalink to this headline">¶</a></h2>
<p>Let’s start with how to calculate a shear-shear two-point auto-correlation.
It’s not necessarily the simplest choice of correlation, but this specific
calculation was the original reason I wrote TreeCorr, so it’s close to my heart.
The basic pattern is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">=</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">Catalog</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
<span class="n">gg</span> <span class="o">=</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">GGCorrelation</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="n">gg</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span>
<span class="n">gg</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out_file_name</span><span class="p">)</span>
</pre></div>
</div>
<p>Here <code class="docutils literal notranslate"><span class="pre">file_name</span></code> is the name of some input file, which has the shear and position
data of your galaxies.  <code class="docutils literal notranslate"><span class="pre">config</span></code> is a dictionary with all the configuration
parameters about how to load the data and define the binning.  We’ll expand that
out shortly.  Finally, <code class="docutils literal notranslate"><span class="pre">out_file_name</span></code> is some output file to write the results.</p>
<p>You can do a cross-correlation between two sets of galaxies very similarly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat1</span> <span class="o">=</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">Catalog</span><span class="p">(</span><span class="n">file_name1</span><span class="p">,</span> <span class="n">config1</span><span class="p">)</span>
<span class="n">cat2</span> <span class="o">=</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">Catalog</span><span class="p">(</span><span class="n">file_name2</span><span class="p">,</span> <span class="n">config2</span><span class="p">)</span>
<span class="n">gg</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">cat1</span><span class="p">,</span> <span class="n">cat2</span><span class="p">)</span>
</pre></div>
</div>
<p>If you would rather not write the results to an output file, but maybe plot them up or do some
further calculation with them, you can access the resulting fields directly as numpy arrays:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xip</span> <span class="o">=</span> <span class="n">gg</span><span class="o">.</span><span class="n">xip</span>            <span class="c1"># The real part of xi+</span>
<span class="n">xim</span> <span class="o">=</span> <span class="n">gg</span><span class="o">.</span><span class="n">xim</span>            <span class="c1"># The real part of xi-</span>
<span class="n">logr</span> <span class="o">=</span> <span class="n">gg</span><span class="o">.</span><span class="n">logr</span>          <span class="c1"># The nominal center of each bin</span>
<span class="n">meanlogr</span> <span class="o">=</span> <span class="n">gg</span><span class="o">.</span><span class="n">meanlogr</span>  <span class="c1"># The mean &lt;log(r)&gt; within the bins</span>
<span class="n">varxi</span> <span class="o">=</span> <span class="n">gg</span><span class="o">.</span><span class="n">varxi</span>        <span class="c1"># The variance of each xi+ or xi- value</span>
                        <span class="c1"># taking into account shape noise only</span>
</pre></div>
</div>
<p>See the doc string for <a class="reference internal" href="gg.html#treecorr.GGCorrelation" title="treecorr.GGCorrelation"><code class="xref any py py-class docutils literal notranslate"><span class="pre">GGCorrelation</span></code></a> for other available attributes.</p>
</div>
<div class="section" id="other-two-point-correlation-classes">
<h2>Other Two-point Correlation Classes<a class="headerlink" href="#other-two-point-correlation-classes" title="Permalink to this headline">¶</a></h2>
<p>The other kinds of correlations each have their own class:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="nn.html#treecorr.NNCorrelation" title="treecorr.NNCorrelation"><code class="xref any py py-class docutils literal notranslate"><span class="pre">NNCorrelation</span></code></a> = count-count  (normal LSS correlation)</p></li>
<li><p><a class="reference internal" href="gg.html#treecorr.GGCorrelation" title="treecorr.GGCorrelation"><code class="xref any py py-class docutils literal notranslate"><span class="pre">GGCorrelation</span></code></a> = shear-shear  (e.g. cosmic shear)</p></li>
<li><p><a class="reference internal" href="kk.html#treecorr.KKCorrelation" title="treecorr.KKCorrelation"><code class="xref any py py-class docutils literal notranslate"><span class="pre">KKCorrelation</span></code></a> = kappa-kappa  (or any other scalar field)</p></li>
<li><p><a class="reference internal" href="ng.html#treecorr.NGCorrelation" title="treecorr.NGCorrelation"><code class="xref any py py-class docutils literal notranslate"><span class="pre">NGCorrelation</span></code></a> = count-shear  (i.e. &lt;gamma_t&gt;(R))</p></li>
<li><p><a class="reference internal" href="nk.html#treecorr.NKCorrelation" title="treecorr.NKCorrelation"><code class="xref any py py-class docutils literal notranslate"><span class="pre">NKCorrelation</span></code></a> = count-kappa  (i.e. &lt;kappa&gt;(R))</p></li>
<li><p><a class="reference internal" href="kg.html#treecorr.KGCorrelation" title="treecorr.KGCorrelation"><code class="xref any py py-class docutils literal notranslate"><span class="pre">KGCorrelation</span></code></a> = kappa-shear</p></li>
</ul>
</div></blockquote>
<p>You should see their doc strings for details, but they all work similarly.
For the last three, there is no auto-correlation option, of course, just the cross-correlation.</p>
<p>The other main difference between these other correlation classes from GG is that there is only a
single correlation function, so it is called <code class="docutils literal notranslate"><span class="pre">xi</span></code> rather than <code class="docutils literal notranslate"><span class="pre">xip</span></code> and <code class="docutils literal notranslate"><span class="pre">xim</span></code>.</p>
<p>Also, NN does not have any kind of <code class="docutils literal notranslate"><span class="pre">xi</span></code> attribute.  You need to perform an additional
calculation involving random catalogs for that.
See <a class="reference internal" href="#using-random-catalogs"><span class="std std-ref">Using random catalogs</span></a> below for more details.</p>
</div>
<div class="section" id="loading-a-catalog">
<h2>Loading a Catalog<a class="headerlink" href="#loading-a-catalog" title="Permalink to this headline">¶</a></h2>
<p>OK, now let’s get into some of the details about how to load data into a <a class="reference internal" href="catalog.html#treecorr.Catalog" title="treecorr.Catalog"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Catalog</span></code></a>.</p>
<p>To specify the names of the columns in the input file, as well as other details about
how to interpret the columns, you can either use a <code class="docutils literal notranslate"><span class="pre">config</span></code> dict, as we did above,
or specify keyword arguments.  Either way is fine, although to be honest, the keywords
are probably more typical, so we’ll use that from here on.</p>
<p>For a shear catalog, you need to specify the position of each galaxy and the
shear values, g1 and g2.  You do this by stating which column in the input catalog
corresponds to each value you need.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">=</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">Catalog</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;input_cat.fits&#39;</span><span class="p">,</span>
                       <span class="n">x_col</span><span class="o">=</span><span class="s1">&#39;X_IMAGE&#39;</span><span class="p">,</span> <span class="n">y_col</span><span class="o">=</span><span class="s1">&#39;Y_IMAGE&#39;</span><span class="p">,</span> <span class="n">g1_col</span><span class="o">=</span><span class="s1">&#39;E1&#39;</span><span class="p">,</span> <span class="n">g2_col</span><span class="o">=</span><span class="s1">&#39;E2&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>For FITS files, you specify the columns by name, which correspond to the column name
in the FITS table.  For ASCII input files, you specify the column number instead:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">=</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">Catalog</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;input_cat.dat&#39;</span><span class="p">,</span>
                       <span class="n">x_col</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">y_col</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">g1_col</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">g2_col</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
<p>where the first column in numbered 1, not 0.</p>
<p>When the positions are given as right ascension and declination on the celestial
sphere, rather than x and y on a flat projection (like an image), you also need
to specify what units the angles use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">=</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">Catalog</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;input_cat.fits&#39;</span><span class="p">,</span>
                       <span class="n">ra_col</span><span class="o">=</span><span class="s1">&#39;RA&#39;</span><span class="p">,</span> <span class="n">dec_col</span><span class="o">=</span><span class="s1">&#39;DEC&#39;</span><span class="p">,</span> <span class="n">g1_col</span><span class="o">=</span><span class="s1">&#39;E1&#39;</span><span class="p">,</span> <span class="n">g2_col</span><span class="o">=</span><span class="s1">&#39;E2&#39;</span><span class="p">,</span>
                       <span class="n">ra_units</span><span class="o">=</span><span class="s1">&#39;hours&#39;</span><span class="p">,</span> <span class="n">dec_units</span><span class="o">=</span><span class="s1">&#39;degrees&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>For the catalog of the N part of a calculation, you can skip the <code class="docutils literal notranslate"><span class="pre">g1_col</span></code> and <code class="docutils literal notranslate"><span class="pre">g2_col</span></code>.
Those only need positions. For a K correlation, you should specify <code class="docutils literal notranslate"><span class="pre">k_col</span></code> instead:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">=</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">Catalog</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;input_cat.fits&#39;</span><span class="p">,</span>
                       <span class="n">ra_col</span><span class="o">=</span><span class="s1">&#39;RA&#39;</span><span class="p">,</span> <span class="n">dec_col</span><span class="o">=</span><span class="s1">&#39;DEC&#39;</span><span class="p">,</span> <span class="n">k_col</span><span class="o">=</span><span class="s1">&#39;KAPPA&#39;</span><span class="p">,</span>
                       <span class="n">ra_units</span><span class="o">=</span><span class="s1">&#39;hours&#39;</span><span class="p">,</span> <span class="n">dec_units</span><span class="o">=</span><span class="s1">&#39;degrees&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>See the documentation for <a class="reference internal" href="catalog.html#treecorr.Catalog" title="treecorr.Catalog"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Catalog</span></code></a> for more options, such as how to flip the sign of
g1 or g2 (unfortunately not everyone follows the same conventions), use weights,
skip objects with specific flags, and more.</p>
</div>
<div class="section" id="building-a-catalog-from-numpy-arrays">
<h2>Building a Catalog from numpy arrays<a class="headerlink" href="#building-a-catalog-from-numpy-arrays" title="Permalink to this headline">¶</a></h2>
<p>If the provided tools for reading in the data from an input file are insufficient, or if
the data you want to use are being generated in Python natively, so there is no file
to read, then you can instead build the <a class="reference internal" href="catalog.html#treecorr.Catalog" title="treecorr.Catalog"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Catalog</span></code></a> directly from numpy arrays:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_values</span><span class="p">)</span>    <span class="c1"># These might be the output of</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_values</span><span class="p">)</span>    <span class="c1"># some calculation...</span>
<span class="n">g1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">g1_values</span><span class="p">)</span>
<span class="n">g2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">g2_values</span><span class="p">)</span>

<span class="n">cat</span> <span class="o">=</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">Catalog</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">g1</span><span class="o">=</span><span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="o">=</span><span class="n">g2</span><span class="p">)</span>
</pre></div>
</div>
<p>You always need to include either <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> or <code class="docutils literal notranslate"><span class="pre">ra</span></code> and <code class="docutils literal notranslate"><span class="pre">dec</span></code>.
Which other columns you need depends on what kind of correlation function you want to calculate
from the data.  For GG, you need <code class="docutils literal notranslate"><span class="pre">g1</span></code> and <code class="docutils literal notranslate"><span class="pre">g2</span></code>, but for K correlations, you would use
<code class="docutils literal notranslate"><span class="pre">k</span></code> instead.</p>
<p>You can optionally provide a weight column as well with <code class="docutils literal notranslate"><span class="pre">w</span></code> if desired.
This will then perform a weighted correlation using those weights.</p>
<p>Again, see the doc string for <a class="reference internal" href="catalog.html#treecorr.Catalog" title="treecorr.Catalog"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Catalog</span></code></a> for more information.</p>
</div>
<div class="section" id="defining-the-binning">
<h2>Defining the binning<a class="headerlink" href="#defining-the-binning" title="Permalink to this headline">¶</a></h2>
<p>For the default <a class="reference internal" href="binning.html#binning"><span class="std std-ref">bin_type</span></a>, <code class="docutils literal notranslate"><span class="pre">&quot;Log&quot;</span></code>, the correlation function is binned
in equally spaced bins in <span class="math notranslate nohighlight">\(\log(r)\)</span>.  where <span class="math notranslate nohighlight">\(r\)</span> represents the separation
between two points being correlated.</p>
<p>Typically you would specify the minimum and
maximum separation you want accumulated as <code class="docutils literal notranslate"><span class="pre">min_sep</span></code> and <code class="docutils literal notranslate"><span class="pre">max_sep</span></code> respectively,
along with <code class="docutils literal notranslate"><span class="pre">nbins</span></code> to specify how many bins to use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gg</span> <span class="o">=</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">GGCorrelation</span><span class="p">(</span><span class="n">min_sep</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">max_sep</span><span class="o">=</span><span class="mf">100.</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>When the positions are given as (ra, dec), then the separations are also angles,
so you need to specify what units to use. These do not have to be the same units
as you used for either ra or dec:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gg</span> <span class="o">=</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">GGCorrelation</span><span class="p">(</span><span class="n">min_sep</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">max_sep</span><span class="o">=</span><span class="mf">100.</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">sep_units</span><span class="o">=</span><span class="s1">&#39;arcmin&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Most correlation functions of interest in astronomy are roughly power laws, so log
binning puts similar signal-to-noise in each bin, making it often a good choice.
However, for some use cases, linear binning is more appropriate.  This is possible
using the <code class="docutils literal notranslate"><span class="pre">bin_type</span></code> parameter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gg</span> <span class="o">=</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">GGCorrelation</span><span class="p">(</span><span class="n">min_sep</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span> <span class="n">max_sep</span><span class="o">=</span><span class="mf">15.</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">bin_type</span><span class="o">=</span><span class="s1">&#39;Linear&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="binning.html#binning"><span class="std std-ref">Binning</span></a> for more details about this option and the <code class="docutils literal notranslate"><span class="pre">&quot;TwoD&quot;</span></code> binning,
as well as some other options related to binning.</p>
<p>Finally, the default way of calculating separations is a normal Euclidean metric.
However, TreeCorr implements a number of other metrics as well, which are useful
in various situations.  See <a class="reference internal" href="metric.html#metrics"><span class="std std-ref">Metrics</span></a> for details.</p>
</div>
<div class="section" id="three-point-correlation-classes">
<h2>Three-point Correlation Classes<a class="headerlink" href="#three-point-correlation-classes" title="Permalink to this headline">¶</a></h2>
<p>TreeCorr can also do three-point correlations, to measure how the product of three fields
depends on the size and shape of the triangle connecting three points.
So far, we have only implemented the auto-correlation three-point functions:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="nnn.html#treecorr.NNNCorrelation" title="treecorr.NNNCorrelation"><code class="xref any py py-class docutils literal notranslate"><span class="pre">NNNCorrelation</span></code></a>  # count-count-count</p></li>
<li><p><a class="reference internal" href="ggg.html#treecorr.GGGCorrelation" title="treecorr.GGGCorrelation"><code class="xref any py py-class docutils literal notranslate"><span class="pre">GGGCorrelation</span></code></a>  # shear-shear-shear</p></li>
<li><p><a class="reference internal" href="kkk.html#treecorr.KKKCorrelation" title="treecorr.KKKCorrelation"><code class="xref any py py-class docutils literal notranslate"><span class="pre">KKKCorrelation</span></code></a>  # kappa-kappa-kappa</p></li>
</ul>
</div></blockquote>
<p>These classes are significantly more complicated than the two-point ones,
since they have to deal with the geometry of the triangles being binned.
See their doc strings for more details.</p>
</div>
<div class="section" id="using-random-catalogs">
<h2>Using random catalogs<a class="headerlink" href="#using-random-catalogs" title="Permalink to this headline">¶</a></h2>
<p>For the NN and NNN correlations, the raw calculation is not sufficient to produce the real
correlation function.  You also need to account for the survey geometry (edges, mask, etc.)
by running the same calculation with a random catalog (or several) that have a uniform density,
but the same geometry:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">Catalog</span><span class="p">(</span><span class="n">data_file</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
<span class="n">rand</span> <span class="o">=</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">Catalog</span><span class="p">(</span><span class="n">rand_file</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
<span class="n">dd</span> <span class="o">=</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">NNCorrelation</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="n">dr</span> <span class="o">=</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">NNCorrelation</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="n">rr</span> <span class="o">=</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">NNCorrelation</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="n">dd</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">dr</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">rand</span><span class="p">)</span>
<span class="n">rr</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">rand</span><span class="p">)</span>
<span class="n">xi</span><span class="p">,</span> <span class="n">varxi</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">calculateXi</span><span class="p">(</span><span class="n">rr</span><span class="p">,</span><span class="n">dr</span><span class="p">)</span>
</pre></div>
</div>
<p>This calculates xi = (DD-2DR+RR)/RR for each bin.  This is the Landy-Szalay estimator,
which is the most widely used estimator for count-count correlation functions.  However,
if you want to use a simpler estimator xi = (DD-RR)/RR, then you can omit the dr parameter.
The simpler estimator is slightly biased though, so this is not recommended.</p>
<p>After calling <a class="reference internal" href="nn.html#treecorr.NNCorrelation.calculateXi" title="treecorr.NNCorrelation.calculateXi"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">calculateXi</span></code></a>, the <code class="docutils literal notranslate"><span class="pre">dd</span></code> object above will have <code class="docutils literal notranslate"><span class="pre">xi</span></code>
and <code class="docutils literal notranslate"><span class="pre">varxi</span></code> attributes, which store the results of this calculation.</p>
<p>The NG and NK classes also have a <a class="reference internal" href="ng.html#treecorr.NGCorrelation.calculateXi" title="treecorr.NGCorrelation.calculateXi"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">calculateXi</span></code></a> method to allow
for the use of compensated estimators in those cases as well.
Calling this function updates the <code class="docutils literal notranslate"><span class="pre">xi</span></code> attribute from the uncompensated value to the
compensated value.
These correlations do not suffer as much from masking effects,
so the compensation is not as necessary.  However, it does produce a slightly better estimate
of the correlation function if you are able to use a random catalog.</p>
<p>Furthermore, the <a class="reference internal" href="gg.html#treecorr.GGCorrelation.process" title="treecorr.GGCorrelation.process"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">process</span></code></a> functions can take lists of Catalogs if desired,
in which case it will
do all the possible combinations.  This is especially relevant for doing randoms,
since the statistics get better if you generate several randoms and do all the correlations to beat down the noise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rand_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">Catalog</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">config</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">rand_files</span> <span class="p">]</span>
<span class="n">dr</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">rand_list</span><span class="p">)</span>
<span class="n">rr</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">rand_list</span><span class="p">)</span>
</pre></div>
</div>
<p>The corresponding three-point NNN calculation is even more complicated, since there are 8 total
combinations that need to be computed: zeta = (DDD-DDR-DRD-RDD+DRR+RDR+RRD-RRR)/RRR.
Because of the triangle geometry, we don’t have DRR = DRD = RDD, so all 8 need to be computed.
See the docstring for <a class="reference internal" href="nnn.html#treecorr.NNNCorrelation.calculateZeta" title="treecorr.NNNCorrelation.calculateZeta"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">calculateZeta</span></code></a> for more details.</p>
</div>
<div class="section" id="manually-accumulating-the-correlation-function">
<h2>Manually accumulating the correlation function<a class="headerlink" href="#manually-accumulating-the-correlation-function" title="Permalink to this headline">¶</a></h2>
<p>For even more control over the calculation, you can break up the steps in the
<a class="reference internal" href="gg.html#treecorr.GGCorrelation.process" title="treecorr.GGCorrelation.process"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">process</span></code></a> functions.  There are typically three steps:</p>
<ol class="arabic simple">
<li><p>Calculate the shear variance or kappa variance as needed (i.e. for anything but NN correlations).</p></li>
<li><p>Accumulate the correlations into the bins for each auto-correlation and cross-correlation desired.</p></li>
<li><p>Finalize the calculation.</p></li>
</ol>
<p>If you have several pairs of catalogs that you want to accumulate into a single correlation
function, you could write the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lens_cats</span> <span class="o">=</span> <span class="p">[</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">Catalog</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">config</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">lens_files</span> <span class="p">]</span>
<span class="n">source_cats</span> <span class="o">=</span> <span class="p">[</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">Catalog</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">config</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">source_files</span> <span class="p">]</span>
<span class="n">ng</span> <span class="o">=</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">NGCorrelation</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="n">varg</span> <span class="o">=</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">calculateVarG</span><span class="p">(</span><span class="n">source_cats</span><span class="p">)</span>
<span class="k">for</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lens_cats</span><span class="p">,</span> <span class="n">source_cats</span><span class="p">):</span>
    <span class="n">ng</span><span class="o">.</span><span class="n">process_cross</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">)</span>
<span class="n">ng</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">varg</span><span class="p">)</span>
</pre></div>
</div>
<p>In addition to <a class="reference internal" href="ng.html#treecorr.NGCorrelation.process_cross" title="treecorr.NGCorrelation.process_cross"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">process_cross</span></code></a>,
classes that allow auto-correlations have a
<a class="reference internal" href="gg.html#treecorr.GGCorrelation.process_auto" title="treecorr.GGCorrelation.process_auto"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">process_auto</span></code></a> method for manually processing
auto-correlations.  See the doc strings for these methods for more information.</p>
<p>Breaking up the calculation manually like this is probably not often necessary anymore.
It used to be useful for dividing a calculation among several machines, which would
each save their results to disk.  These results could then be reassembled and
finalized after all the results were finished.</p>
<p>However, this work mode is now incorporated directly into TreeCorr via the use of
“patches”.  See <a class="reference internal" href="patches.html#patches"><span class="std std-ref">Patches</span></a> for details about how to automatically
divide up your input catalog into patches and to farm the calculation out to
multiple machines using MPI.</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="params.html" class="btn btn-neutral float-left" title="Configuration Parameters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="changes.html" class="btn btn-neutral float-right" title="Changes from version 4.2 to 4.3" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, Mike Jarvis.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>