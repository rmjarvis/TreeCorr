

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Metrics &mdash; TreeCorr 4.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Binning" href="bintype.html" />
    <link rel="prev" title="KKKCorrelation: Kappa-kappa-kappa correlations" href="kkk.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> TreeCorr
          

          
          </a>

          
            
            
              <div class="version">
                4.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="catalog.html">Input Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="correlation2.html">Two-point Correlation Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="correlation3.html">Three-point Correlation Functions</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Metrics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#euclidean">“Euclidean”</a></li>
<li class="toctree-l2"><a class="reference internal" href="#arc">“Arc”</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rperp-or-fisherrperp">“Rperp” or “FisherRperp”</a></li>
<li class="toctree-l2"><a class="reference internal" href="#oldrperp">“OldRperp”</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rlens">“Rlens”</a></li>
<li class="toctree-l2"><a class="reference internal" href="#periodic">“Periodic”</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="bintype.html">Binning</a></li>
<li class="toctree-l1"><a class="reference internal" href="field.html">Fields</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripts.html">The corr2 and corr3 driver scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="changes.html">Changes from version 3.3 to 4.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">Previous History</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">TreeCorr</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Metrics</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/metric.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="metrics">
<h1>Metrics<a class="headerlink" href="#metrics" title="Permalink to this headline">¶</a></h1>
<p>The correlation functions need to know how to calculate distances between the points,
that is, the metric defining the space.</p>
<p>In most cases, you will probably want to use the default Metric, called “Euclidean”,
which just uses the normal Euclidean distance between two points.  However, there are a few
other options, which are useful for various applications.</p>
<p>Both <a class="reference internal" href="correlation2.html#treecorr.BinnedCorr2" title="treecorr.BinnedCorr2"><code class="xref py py-class docutils literal notranslate"><span class="pre">BinnedCorr2</span></code></a> and <a class="reference internal" href="correlation3.html#treecorr.BinnedCorr3" title="treecorr.BinnedCorr3"><code class="xref py py-class docutils literal notranslate"><span class="pre">BinnedCorr3</span></code></a> take an optional
<code class="docutils literal notranslate"><span class="pre">metric</span></code> parameter, which should be one of the following string values:</p>
<div class="section" id="euclidean">
<h2>“Euclidean”<a class="headerlink" href="#euclidean" title="Permalink to this headline">¶</a></h2>
<p>This is the default metric, and is the only current option for 2-dimensional flat correlations,
i.e. when the coordinates are given by (x,y), rather than either (x,y,z), (ra,dec), or (ra,dec,r).</p>
<p>For 2-dimensional coordinate systems, the distance is defined as</p>
<p><span class="math notranslate nohighlight">\(d_{\rm Euclidean} = \sqrt{(x_2-x_1)^2 + (y_2-y_1)^2}\)</span></p>
<p>For 3-dimensional coordinate systems, the distance is defined as</p>
<p><span class="math notranslate nohighlight">\(d_{\rm Euclidean} = \sqrt{(x_2-x_1)^2 + (y_2-y_1)^2 + (z_2-z_1)^2}\)</span></p>
<p>For spherical coordinates with distances, (ra,dec,r), the coordinates are first
converted to Cartesian coordinates and the above formula is used.</p>
<p>For spherical coordinates without distances, (ra, dec), the coordinates are placed on the
unit sphere and the above formula is used.  This means that all distances are really chord
distances across the sphere, not great circle distances.  For small angles, this is a small
correction, but as the angles get large, the difference between the great circle distance and
the chord distance becomes significant.  The conversion formula is</p>
<p><span class="math notranslate nohighlight">\(d_{\rm GC} = 2 \arcsin(d_{\rm Euclidean} / 2)\)</span></p>
<p>TreeCorr applies this formula at the end as part of the <code class="docutils literal notranslate"><span class="pre">finalize</span></code> function
(e.g. <a class="reference internal" href="gg.html#treecorr.GGCorrelation.finalize" title="treecorr.GGCorrelation.finalize"><code class="xref py py-meth docutils literal notranslate"><span class="pre">finalize()</span></code></a>), so the <code class="docutils literal notranslate"><span class="pre">meanr</span></code> and <code class="docutils literal notranslate"><span class="pre">meanlogr</span></code> attributes
will be in terms of great circle distances.  However, they will not necessarily be spaced
precisely uniformly in log(r), since the original bin spacing will have been set up in terms
of the chord distances.</p>
</div>
<div class="section" id="arc">
<h2>“Arc”<a class="headerlink" href="#arc" title="Permalink to this headline">¶</a></h2>
<p>This metric is only valid for spherical coordinates (ra,dec).</p>
<p>The distance is defined as</p>
<p><span class="math notranslate nohighlight">\(d_{\rm Arc} = 2 \arcsin(d_{\rm Euclidean} / 2)\)</span></p>
<p>where <span class="math notranslate nohighlight">\(d_{\rm Euclidean}\)</span> is the above “Euclidean” chord distance.</p>
<p>This metric is significantly slower than the “Euclidean” metric, since it requires trigonometric
functions for every pair calculation along the way, rather than just at the end.
In most cases, this extra care is unnecessary, but it provides a means to check if the
chord calculations are in any way problematic for your particular use case.</p>
<p>Also, unlike the “Euclidean” version, the bin spacing will be uniform in log(r) using the
actual great circle distances, rather than being based on the chord distances.</p>
</div>
<div class="section" id="rperp-or-fisherrperp">
<h2>“Rperp” or “FisherRperp”<a class="headerlink" href="#rperp-or-fisherrperp" title="Permalink to this headline">¶</a></h2>
<p>This metric is only valid for 3-dimensional coordinates (ra,dec,r) or (x,y,z).</p>
<p>The distance in this metric is defined as</p>
<p><span class="math notranslate nohighlight">\(d_{\rm Rperp} = \sqrt{d_{\rm Euclidean}^2 - r_\parallel^2}\)</span></p>
<p>where <span class="math notranslate nohighlight">\(r_\parallel\)</span> follows the defintion in Fisher et al, 1994 (MNRAS, 267, 927).
Namely, if <span class="math notranslate nohighlight">\(p_1\)</span> and <span class="math notranslate nohighlight">\(p_2\)</span> are the vector positions from Earth for the
two points, and</p>
<p><span class="math notranslate nohighlight">\(L \equiv \frac{p1 + p2}{2}\)</span></p>
<p>then</p>
<p><span class="math notranslate nohighlight">\(r_\parallel = \frac{(p_2 - p_1) \cdot L}{|L|}\)</span></p>
<p>That is, it breaks up the full 3-d distance into perpendicular and parallel components:
<span class="math notranslate nohighlight">\(d_{\rm 3d}^2 = r_\bot^2 + r_\parallel^2\)</span>,
and it identifies the metric separation as just the perpendicular component, <span class="math notranslate nohighlight">\(r_\bot\)</span>.</p>
<p>Note that this decomposition is really only valid for objects with a relatively small angular
separation, <span class="math notranslate nohighlight">\(\theta\)</span>, on the sky, so the two radial vectors are nearly parallel.
In this limit, the formula for <span class="math notranslate nohighlight">\(d\)</span> reduces to</p>
<p><span class="math notranslate nohighlight">\(d_{\rm Rperp} \approx \left(\frac{2 r_1 r_2}{r_1+r_2}\right) \theta\)</span></p>
<p>This metric also permits the use of two other parameters, <code class="docutils literal notranslate"><span class="pre">min_rpar</span></code> and <code class="docutils literal notranslate"><span class="pre">max_rpar</span></code>,
which set the minimum and maximum values of <span class="math notranslate nohighlight">\(r_\parallel\)</span> for pairs to be included in the
correlations.</p>
<p>The sign of <span class="math notranslate nohighlight">\(r_\parallel\)</span> is defined such that positive values mean
the object from the second catalog is farther away.  Thus, if the first catalog represents
lenses and the second catalog represents lensed source galaxies, then setting
<code class="docutils literal notranslate"><span class="pre">min_rpar</span> <span class="pre">=</span> <span class="pre">0</span></code> will restrict the sources to being in the background of each lens.
Similarly, setting <code class="docutils literal notranslate"><span class="pre">min_rpar</span> <span class="pre">=</span> <span class="pre">-50</span></code>, <code class="docutils literal notranslate"><span class="pre">max_rpar</span> <span class="pre">=</span> <span class="pre">50</span></code> will restrict the sources to be
within 50 Mpc (say, assuming the catalog distances are given in Mpc) of the lenses.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Prior to version 4.0, the “Rperp” name meant what is now called “OldRperp”.
The difference can be significant for some use cases, so if consistency across
versions is importatnt to you, you should either switch to using “OldRperp”
or investigate whether the change to “FisherRperp” is important for your
particular science case.</p>
</div>
</div>
<div class="section" id="oldrperp">
<h2>“OldRperp”<a class="headerlink" href="#oldrperp" title="Permalink to this headline">¶</a></h2>
<p>This metric is only valid for 3-dimensional coordinates (ra,dec,r) or (x,y,z).</p>
<p>This is the version of the Rperp metric that TreeCorr used in versions 3.x.
In version 4.0, we switched the definition of <span class="math notranslate nohighlight">\(r_\parallel\)</span> to the one
used by Fisher et al, 1994 (MNRAS, 267, 927).  The difference turns out to be
non-trivial in some realistic use cases, so we preserve the ability to use the
old version with this metric.</p>
<p>Specifically, if <span class="math notranslate nohighlight">\(r_1\)</span> and <span class="math notranslate nohighlight">\(r_2\)</span> are the two distance from Earth,
then this metric uses <span class="math notranslate nohighlight">\(r_\parallel \equiv r_2-r_1\)</span>.</p>
<p>The distance is then defined as</p>
<p><span class="math notranslate nohighlight">\(d_{\rm OldRperp} = \sqrt{d_{\rm Euclidean}^2 - r_\parallel^2}\)</span></p>
<p>That is, it breaks up the full 3-d distance into perpendicular and parallel components:
<span class="math notranslate nohighlight">\(d_{\rm 3d}^2 = r_\bot^2 + r_\parallel^2\)</span>,
and it identifies the metric separation as just the perpendicular component, <span class="math notranslate nohighlight">\(r_\bot\)</span>.</p>
<p>Note that this decomposition is really only valid for objects with a relatively small angular
separation, <span class="math notranslate nohighlight">\(\theta\)</span>, on the sky, so the two radial vectors are nearly parallel.
In this limit, the formula for <span class="math notranslate nohighlight">\(d\)</span> reduces to</p>
<p><span class="math notranslate nohighlight">\(d_{\rm OldRperp} \approx \left(\sqrt{r_1 r_2}\right) \theta\)</span></p>
<p>As with the regular “Rperp”, this metric permits the use of two other parameters,
<code class="docutils literal notranslate"><span class="pre">min_rpar</span></code> and <code class="docutils literal notranslate"><span class="pre">max_rpar</span></code>,
which set the minimum and maximum values of <span class="math notranslate nohighlight">\(r_\parallel\)</span> for pairs to be included in the
correlations.</p>
<p>The sign of <span class="math notranslate nohighlight">\(r_\parallel\)</span> is defined such that positive values mean
the object from the second catalog is farther away.  Thus, if the first catalog represents
lenses and the second catalog represents lensed source galaxies, then setting
<code class="docutils literal notranslate"><span class="pre">min_rpar</span> <span class="pre">=</span> <span class="pre">0</span></code> will restrict the sources to being in the background of each lens.
Similarly, setting <code class="docutils literal notranslate"><span class="pre">min_rpar</span> <span class="pre">=</span> <span class="pre">-50</span></code>, <code class="docutils literal notranslate"><span class="pre">max_rpar</span> <span class="pre">=</span> <span class="pre">50</span></code> will restrict the sources to be
within 50 Mpc (say, assuming the catalog distances are given in Mpc) of the lenses.</p>
</div>
<div class="section" id="rlens">
<h2>“Rlens”<a class="headerlink" href="#rlens" title="Permalink to this headline">¶</a></h2>
<p>This metric is only valid when the first catalog uses 3-dimensional coordinates
(ra,dec,r) or (x,y,z).  The second catalog may take either 3-d coordinates or spherical
coordinates (ra,dec).</p>
<p>The distance is defined as</p>
<p><span class="math notranslate nohighlight">\(d_{\rm Rlens} = r_1 \sin(\theta)\)</span></p>
<p>where <span class="math notranslate nohighlight">\(\theta\)</span> is the opening angle between the two objects and <span class="math notranslate nohighlight">\(r_1\)</span> is the
radial distance to the object in the first catalog.
In other words, this is the distance from the first object (nominally the “lens”) to the
line of sight to the second object (nominally the “source”).  This is commonly referred to
as the impact parameter of the light path from the source as it passes the lens.</p>
<p>This metric also permits the use of two other parameters, <code class="docutils literal notranslate"><span class="pre">min_rpar</span></code> and <code class="docutils literal notranslate"><span class="pre">max_rpar</span></code>,
which set the minimum and maximum values of <span class="math notranslate nohighlight">\(r_\parallel = r_2 - r_1\)</span> for pairs to be
included in the correlations.</p>
<p>The sign of <span class="math notranslate nohighlight">\(r_\parallel\)</span> is defined such that positive values mean
the object from the second catalog is farther away. Thus, setting
<code class="docutils literal notranslate"><span class="pre">min_rpar</span> <span class="pre">=</span> <span class="pre">0</span></code> will restrict the sources to being in the background of each lens.
Similarly, setting <code class="docutils literal notranslate"><span class="pre">min_rpar</span> <span class="pre">=</span> <span class="pre">-50</span></code>, <code class="docutils literal notranslate"><span class="pre">max_rpar</span> <span class="pre">=</span> <span class="pre">50</span></code> will restrict the sources to be
within 50 Mpc (say, assuming the catalog distances are given in Mpc) of the lenses.</p>
<p>Since the basic metric does not use the radial distance to the source galaxies (<span class="math notranslate nohighlight">\(r_2\)</span>),
they are not required.  You may just provide (ra,dec) coordinates for the sources.
However, if you want to use the <code class="docutils literal notranslate"><span class="pre">min_rpar</span></code> or <code class="docutils literal notranslate"><span class="pre">max_rpar</span></code> options, then
the source coordinates need to include r.</p>
</div>
<div class="section" id="periodic">
<h2>“Periodic”<a class="headerlink" href="#periodic" title="Permalink to this headline">¶</a></h2>
<p>This metric is equivalent to the Euclidean metric for either 2-d or 3-d coordinate systems,
except that the space is given periodic boundaries, and the distance between two
points is taken to be the <em>smallest</em> distance in the periodically repeating space.
It is invalid for Spherical coordinates.</p>
<p>When constructing the correlation object, you need to set <code class="docutils literal notranslate"><span class="pre">period</span></code> if the period is the
same in each direction.  Or if you want different periods in each direction, you can
set <code class="docutils literal notranslate"><span class="pre">xperiod</span></code>, <code class="docutils literal notranslate"><span class="pre">yperiod</span></code>, and (if 3-d) <code class="docutils literal notranslate"><span class="pre">zperiod</span></code> individually.
We call these periods <span class="math notranslate nohighlight">\(L_x\)</span>, <span class="math notranslate nohighlight">\(L_y\)</span>, and <span class="math notranslate nohighlight">\(L_z\)</span> below.</p>
<p>The distance is defined as</p>
<div class="math notranslate nohighlight">
\[\begin{split}dx &amp;= \min \left(|x_2 - x_1|, L_x - |x_2-x_1| \right) \\
dy &amp;= \min \left(|y_2 - y_1|, L_y - |y_2-y_1| \right) \\
dz &amp;= \min \left(|z_2 - z_1|, L_z - |z_2-z_1| \right)\end{split}\]</div>
<div class="math notranslate nohighlight">
\[d_{\rm Periodic} = \sqrt{dx^2 + dy^2 + dz^2}\]</div>
<p>Of course, for 2-dimensional coordinate systems, <span class="math notranslate nohighlight">\(dz = 0\)</span>.</p>
<p>This metric is particularly relevant for data generated from N-body simuluations, which
often use periodic boundary conditions.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="bintype.html" class="btn btn-neutral float-right" title="Binning" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="kkk.html" class="btn btn-neutral float-left" title="KKKCorrelation: Kappa-kappa-kappa correlations" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Mike Jarvis

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>